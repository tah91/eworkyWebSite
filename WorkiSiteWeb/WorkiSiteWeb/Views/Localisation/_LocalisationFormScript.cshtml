@model Worki.Data.Models.LocalisationFormViewModel

<script type="text/javascript">
    require(["@Url.VersionedContent(Links.Scripts.jquery_placeholder_js)"], function () {
        $('input, textarea').placeholder();
    });

    require(["@MiscHelpers.UrlConstants.jqueryui", "http://maps.google.com/maps/api/js?sensor=true&region=FR&callback=initialize"], function () {

    });

    function initialize() {
        require(["@Url.VersionedContent(Links.Scripts.WorkiMap_js)"], function () {
            //locate address on edition map, and autofill postal code and country
		    checkIfExist = function(localisations) {
				    var first = localisations[0];
				    if(first==null){
                        $("#localisationAtSamePlaceReplace").replaceWith('<div id="localisationAtSamePlaceReplace"></div>');
					    return;
                    }

				    var message = '@Worki.Resources.Views.Localisation.LocalisationFormString.ThePlace1'+ first.Name + '@Worki.Resources.Views.Localisation.LocalisationFormString.ThePlace2';
                    $("#localisationAtSamePlaceReplace").replaceWith('<div id="localisationAtSamePlaceReplace"><div class="localisationAtSamePlace">' + message + '</div></div>');
				    //alert(message);
		    }
		    GetSimilarLocalisation = function(currentLatitude,currentLongitude){
			    @if (Model.Localisation.ID == 0)
			    {
				    @:var action = '@Url.Action(MVC.Localisation.ActionNames.FindSimilarLocalisation,MVC.Localisation.Name)';
				    @:$.post(action, { latitude: currentLatitude, longitude: currentLongitude }, checkIfExist, "json");
			    }
		    }
		    var workiGeoCoder = new WorkiGeocoder('#Localisation_Latitude', '#Localisation_Longitude', null, null, null ,'#Localisation_City','#Localisation_PostalCode','#Localisation_Country');
		    var workiMap = new WorkiMap('editMapDiv','#Localisation_Latitude', '#Localisation_Longitude');
		    var latitude = @Model.Localisation.Latitude;
		    var longitude = @Model.Localisation.Longitude;
		    var title = "@Model.Localisation.Name";
		    workiMap.LoadDetailMap(latitude,longitude,title,true);
		    FindAddress = function (evt) {
			    var addressValue = jQuery.trim($("#Localisation_Adress").val());
			    var postalCodeValue = jQuery.trim($("#Localisation_PostalCode").val());
			    var cityValue = jQuery.trim($("#Localisation_City").val());
			    if( addressValue === "" || cityValue === "" )
				    return;
			    var address = addressValue + ' ' + postalCodeValue + ' ' + cityValue;
			    if (address.length < 1)
				    return;
				
			    workiGeoCoder.GeocodeAddress(address, GetSimilarLocalisation);
			    workiMap.ClearMap();
			    workiMap.FindAddressOnMap(address);
		    }

		    $("#Localisation_Adress").blur(function (evt) {
			    FindAddress(evt);
		    });
		    $("#Localisation_PostalCode").blur(function (evt) {
			    //FindAddress(evt);
		    });
		    $("#Localisation_City").blur(function (evt) {
			    FindAddress(evt);
		    });

		    $('#resetPos').click(function() {
			    FindAddress();
		    });

		    $("#localisationEditForm").submit(function () {
			    var lat = jQuery.trim($("#Localisation_Latitude").val());
			    var lng = jQuery.trim($("#Localisation_Longitude").val());
			    if(lat == "0" || lng == "0")
				    FindAddress(null);

			    var mail = $("#Localisation_Mail").val().replace(/ /g,'');
                $("#Localisation_Mail").val(mail);
                var coffeePrice = $("#Localisation_LocalisationData_CoffeePrice").val();
			    var newCoffeePrice = coffeePrice.replace(",", ".");
                $("#Localisation_LocalisationData_CoffeePrice").val(newCoffeePrice);
                return true;
            });
        });
    }

    $("#f_Wifi_Free").click(function () {
    var isChecked = $("#f_Wifi_Free:checked").val();
    if (isChecked == 'true') {
        $("#f_Wifi_Not_Free").attr('checked', false);
        }
    });

    $("#f_Wifi_Not_Free").click(function () {
    var isChecked = $("#f_Wifi_Not_Free:checked").val();
    if (isChecked == 'true') {
        $("#f_Wifi_Free").attr('checked', false);
        }
    });

	InitOpenning = function () {
		// init
		var acces24 = $("#f_Access24:checked").val();
		var isLunchClose = $("#f_LunchClose:checked").val();

		if (acces24 == 'true') {
			$(".editOpenning").hide();
			$("#lunchCloseChecked").hide();
		}
		else {
			$(".editOpenning").show();
			$("#lunchCloseChecked").show();
		}

		if (isLunchClose == 'true') {
			$(".lunchclose").show();
		}
		else {
			$(".lunchclose").hide();
		}
	};

	InitOpenning();

	// event
	$("#f_Access24").click(function () {
		var is24 = $("#f_Access24:checked").val();
		if (is24 == 'true') {
			$(".editOpenning").hide();
			$("#lunchCloseChecked").hide();
		}
		else {
			$(".editOpenning").show();
			$("#lunchCloseChecked").show();
		}
	});

	$("#f_LunchClose").click(function () {
		var isLunchClose = $("#f_LunchClose:checked").val();
		if (isLunchClose == 'true') {
			$(".lunchclose").show();
		}
		else {
			$(".lunchclose").hide();
		}
	});
		
	//auto fill opening times from monday blur
	AutoFillFromMonday = function(ext)
	{
		var monValue = jQuery.trim($('#Localisation_Mon'+ext).val());
		if(monValue === "")
			return;
		$('#Localisation_Tue'+ext).val(monValue);
		$('#Localisation_Wed'+ext).val(monValue);
		$('#Localisation_Thu'+ext).val(monValue);
		$('#Localisation_Fri'+ext).val(monValue);
	}
	$('#Localisation_MonOpen').blur(function (evt) {
		AutoFillFromMonday('Open');
	});
	$('#Localisation_MonClose').blur(function (evt) {
		AutoFillFromMonday('Close');
	});
	$('#Localisation_MonOpen2').blur(function (evt) {
		AutoFillFromMonday('Open2');
	});
	$('#Localisation_MonClose2').blur(function (evt) {
		AutoFillFromMonday('Close2');
	});
</script>