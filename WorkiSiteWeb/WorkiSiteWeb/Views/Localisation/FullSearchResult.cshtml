@model Worki.Data.Models.SearchCriteriaFormViewModel

@section HeadContent
{
    <meta name="robots" content="noindex">
    <title>@Html.WorkiTitle(Worki.Resources.Views.Search.SearchString.SearchResult)</title>
    <link href="@Url.VersionedContent(Links.Content.Search_min_css)" rel="stylesheet" type="text/css" />
	<link href="@Url.VersionedContent(Links.Content.LocalisationDetail_min_css)" rel="stylesheet" type="text/css" />
    <link href="@Url.VersionedContent(Links.Content.skin_min_css)" rel="stylesheet" type="text/css"  />
    <link href="@Url.VersionedContent(Links.Content.rateit_min_css)" rel="stylesheet" type="text/css" />
    <link href="@Url.VersionedContent(Links.Content.jquery_ui_1_8_12_custom_min_css)" rel="stylesheet" type="text/css"/>
}

@{
	var rvd = WebHelper.GetRVD(this);
	int order = 0;
	int.TryParse((string)rvd["order"], out order);
	bool byDistance = order == (int)eOrderBy.Distance;
	var distRvd = WebHelper.GetRVD(this);
	var ratingRvd = WebHelper.GetRVD(this);
	distRvd["order"] = (int)eOrderBy.Distance;
	ratingRvd["order"] = (int)eOrderBy.Rating;
}


<div class="float-right blue order">
    @Html.ActionLink(Worki.Resources.Views.Search.SearchString.DistanceOrdered, MVC.Localisation.ActionNames.FullSearchResult, distRvd, new Dictionary<string, object> { { "class", byDistance ? "noUnderline" : null } }) <text>|</text>
    @Html.ActionLink(Worki.Resources.Views.Search.SearchString.RateOrdered, MVC.Localisation.ActionNames.FullSearchResult, ratingRvd, new Dictionary<string, object> { { "class", !byDistance ? "noUnderline" : null } }) 
</div>
@RazorHelpers.TitleDiv(string.Format(Worki.Resources.Views.Search.SearchString.YourSearchResult, Model.List.Count), "Blue")

<div class="detailContent relative" id="globalContainer">
    <div class="resultDiv float-left blockContainer">
        <div class="searchFormBlockLeft">
            @for (int i = 0; i < Model.PageResults.Count; ++i)
			{
				var index = Model.PagingInfo.GlobalIndex(i);
                @Html.Partial(MVC.Localisation.Views._SearchResultSummary, Model.GetSingleResult(index))
			}

			<div class="pager">
				@Html.PageLinks(Model.PagingInfo, x => { rvd["page"] = x;return Url.Action(MVC.Localisation.ActionNames.FullSearchResult, rvd);})
			</div>
        </div>    
    </div>

    <div class="searchFormBlock float-right blockContainer">
		<div class="contentBlock" id="resultSearchBlock">
			<div class="resultsMapDiv">
                <span class="blue">@Worki.Resources.Views.Search.SearchString.ResultOnMap</span>
                <div class="mapContainer" id="resultsMap">
                </div>
            </div> 
        
            <div class="searchResultFormDiv" id="searchFormReset">
                <h3 class="blue">@Worki.Resources.Views.Search.SearchString.RefineSearch</h3>
                @using (Html.BeginForm(MVC.Localisation.ActionNames.FullSearch, MVC.Localisation.Name, FormMethod.Post, new { id = "searchform" }))
                {
                    @Html.AntiForgeryToken()
					@Html.HiddenFor(model => model.Criteria.LocalisationData.Latitude)
                    @Html.HiddenFor(model => model.Criteria.LocalisationData.Longitude)
                    <h4 class="toogle_item toogle_trigger toogle_trigger_click active"><span class="blue">@Worki.Resources.Views.Localisation.LocalisationString.Localisation</span></h4>
                    <div class="toogle_container active">
                        <div class="block">
                            <div class="editor-field">
                                @Html.TextBoxFor(model => model.Criteria.Place)
                            </div>
                        </div>
                    </div>
                    
                    <h4 class="toogle_item toogle_trigger toogle_trigger_click active"><span class="blue">@Worki.Resources.Views.Localisation.LocalisationFormString.Offers</span></h4>
                    <div class="toogle_container active">
                        <div class="block">
                            <div class="editor-field">
                                @Html.DropDownListFor(m=>m.Criteria.OfferData.Type, Model.Offers, new { @class = "offerSelect" })
                            </div>
                        </div>
		            </div>

                    <h4 class="toogle_item toogle_trigger toogle_trigger_click active"><span class="blue">@Worki.Resources.Views.Localisation.LocalisationFormString.Facilities</span></h4>
                    <div class="toogle_container active">
                        <div class="block">
                            @Html.Partial(MVC.Localisation.Views._ServicesSelector)
                        </div>
                    </div>
                    
                    <h4 class="toogle_item toogle_trigger toogle_trigger_click active"><span class="blue">@Worki.Resources.Views.Search.SearchString.KindOfLocation</span></h4>
                    <div class="toogle_container active">
                        <div class="block">
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.CoworkingSpace)
                                @Html.LabelFor(model => model.Criteria.CoworkingSpace)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.Telecentre)
                                @Html.LabelFor(model => model.Criteria.Telecentre)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.SharedOffice)
                                @Html.LabelFor(model => model.Criteria.SharedOffice)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.BuisnessCenter)
                                @Html.LabelFor(model => model.Criteria.BuisnessCenter)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.SpotWifi)
                                @Html.LabelFor(model => model.Criteria.SpotWifi)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.CoffeeResto)
                                @Html.LabelFor(model => model.Criteria.CoffeeResto)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.Biblio)
                                @Html.LabelFor(model => model.Criteria.Biblio)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.TravelerSpace)
                                @Html.LabelFor(model => model.Criteria.TravelerSpace)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.WorkingHotel)
                                @Html.LabelFor(model => model.Criteria.WorkingHotel)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.PrivateArea)
                                @Html.LabelFor(model => model.Criteria.PrivateArea)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.PublicSpace)
                                @Html.LabelFor(model => model.Criteria.PublicSpace)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.Hotel)
                                @Html.LabelFor(model => model.Criteria.Hotel)
                            </div>
                        </div>
                    </div>

                    <h4 class="toogle_item toogle_trigger toogle_trigger_click"><span class="blue">@Worki.Resources.Views.Localisation.LocalisationFormString.Services</span></h4>
                    <div class="toogle_container">
                        <div class="block">
                            <div>
                                <div id="searchOption0">
                                    <div id="searchOptionToReplace">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="resetSearch">
                        <input type="submit" class="buttonBlue buttonStd imageBtn float-right" value="@Worki.Resources.Views.Shared.SharedString.Reset"/>
                        <div class="clear"></div>
                    </div>
				}
            </div>
		</div>
    </div>

	<div class="clear">
    </div>
</div>

@section ScriptContent
{
    <script type="text/javascript">
        require(["@Url.VersionedContent(Links.Scripts.tabs_js)"]);
        require(["@Url.VersionedContent(Links.Scripts.jquery_rateit_js)"]);
        require(["@MiscHelpers.UrlConstants.jqueryui", "http://maps.google.com/maps/api/js?sensor=true&region=FR&callback=initialize"], function () {

        });

        function initialize() {
            require(["@Url.VersionedContent(Links.Scripts.WorkiMap_js)"], function () {
                var resultsMap = new WorkiMap('resultsMap');
                var where = "@Model.Criteria.Place";
                resultsMap.LoadSearchMap(where);
                var bounds = new google.maps.LatLngBounds();
				function addMarker(latitude, longitude, name)
				{
                    var LL = new google.maps.LatLng(latitude,longitude);
                    resultsMap.LoadPin(LL, name);
                    bounds.extend(LL);
				}
                @foreach (var localisation in Model.PageResults)
				{
					@:addMarker(@localisation.Latitude, @localisation.Longitude, "@Html.Raw(localisation.Name)");
                }
                @if (Model.PageResults.Count >= 2)
				{
                    <text>
                    resultsMap.FitBoundsSearchResults(bounds);
                    </text>
				}
                var workiAutocomplete = new WorkiAutoComplete('#Criteria_Place');
                workiAutocomplete.SetAutocomplete();
            });   
        }

        // check where the shoppingcart-div is  
        var offset = $('#resultSearchBlock').offset();  
        var width = $('#resultSearchBlock').width();  

        $(window).scroll(function () {  
            var searchBlock = $('#resultSearchBlock');
            var container = $('#globalContainer');
            var y = $(window).scrollTop();
            var yo = offset.top;
            var searchBottom= y + searchBlock.outerHeight();
            var containerBottom = yo + container.outerHeight();
            if (y < yo) {
                searchBlock.removeClass('fixed').removeClass('newbottom');  
            }
            else if (y > yo && y + searchBlock.outerHeight()  < yo + container.outerHeight()) {
                searchBlock.removeClass('newbottom').addClass('fixed').width(width);  
            }
            else {
                searchBlock.removeClass('fixed').addClass('newbottom');
            }
        });
    </script>
    @Html.Partial(MVC.Localisation.Views._SelectSearchScript, Model.Criteria, ViewData)
}
