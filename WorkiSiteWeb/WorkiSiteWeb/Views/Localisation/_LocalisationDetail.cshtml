@model Worki.Data.Models.Localisation

@helper OfferBlock(Localisation localisation, LocalisationOffer offerType)
{
	var offers = localisation.GetOffers(offerType);
	foreach (var offer in offers)
	{
	  	<div class="innerContentBlock">
            <h3 class="blue">@offer.Name</h3>
			@if (offer.OfferFiles.Count > 0)
			{
			<div class="offerGallery">
				@foreach (var item in offer.OfferFiles)
				{
					<a href="@ControllerHelpers.GetUserImagePath(item.FileName, false, PictureData.GetFolder(ProviderType.Offer))" class="hidden">
            			<img title="@offer.Name" alt="@offer.Name" src="@ControllerHelpers.GetUserImagePath(item.FileName, false, PictureData.GetFolder(ProviderType.Offer))"/>
        			</a>                        
				}
			</div>
			<div class="clear"></div>
			}
			@if (offer.OfferFeatures.Count() == 0)
			{
				<div class="italic">@Worki.Resources.Views.Offer.OfferString.InfoUnknown</div>
			}
			else
			{
			<div class="featureTag">
				<ul>
				@foreach (var item in offer.OfferFeatures)
				{
					<li>@FeatureHelper.Display(item)</li>
				}
				</ul>
			</div> 
			<div class="clear"></div>
			}
			<div class="float-right">
				<div class="priceDisplay float-left bold orange">
                    <div class="featureTag">
					    <ul>
                        @if (!string.IsNullOrEmpty(offer.GetAvailabilityDisplay()))
                        {
                            <li>@offer.GetAvailabilityDisplay()</li>   
                        }
					    @foreach (var price in offer.OfferPrices)
					    {
                            var priceDisplay = price.GetPriceDisplay();
                            if (!string.IsNullOrEmpty(priceDisplay))
                            {
                                <li>@priceDisplay</li> 
                            }
					    }
					    </ul>
				    </div> 
				    <div class="clear"></div>
				</div>
				@if (offer.HasProduct)
				{
					if (offer.CanHaveQuotation && offer.IsQuotable)
					{
						<div class="buttonStd buttonBlue linkImg float-right">
							@Html.ActionLink(Worki.Resources.Views.Booking.BookingString.AskQuotation, MVC.Quotation.Create(offer.Id))
						</div>
					}
					else if (offer.CanHaveBooking && offer.IsBookable)
					{
						<div class="buttonStd buttonBlue linkImg float-right">
							@Html.ActionLink(Worki.Resources.Views.Localisation.LocalisationString.BookIt, MVC.Booking.Create(offer.Id))
						</div>
					}
					<div class="clear"></div>
				}
			</div>
			<div class="clear"></div>
		</div>
	}	
}

@{
	var itinLink = "http://maps.google.com/maps?daddr=" + Model.Adress + " " + Model.PostalCode + " " + Model.City;
	var fullName = Model.GetFullName();
}
<div itemscope itemtype="http://schema.org/LocalBusiness">
	<div class="localisationDetailHead">
		<div class="localisationTitle float-left">
			<h1 class="localisationName bold blue" itemprop="name">@fullName</h1>
			<div class="localisationSubtitle" itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">
				<h2 class="localisationCity bold orange">@Localisation.GetLocalisationType(Model.TypeValue)</h2>&nbsp;&nbsp;
				<a href="@itinLink" target="_blank">
					<span itemprop="streetAddress">@Model.Adress</span> - <span itemprop="postalCode">@Model.PostalCode</span> <span itemprop="addressLocality">@Model.City</span>
				</a>
			</div>
			<div itemprop="geo" itemscope itemtype="http://schema.org/GeoCoordinates">
				<meta itemprop="latitude" content="@Model.Latitude" />
				<meta itemprop="longitude" content="@Model.Longitude" />
			</div>
		</div>
		<div class="localisationShare float-right">
		@{
			var link = Model.GetDetailFullUrl(Url);
			if (Request.IsAuthenticated)
			{
				var id = WebHelper.GetIdentityId(User.Identity);
				if (id != 0)
				{
					if (Model.FavoriteLocalisations.Where(f => f.MemberId == id).Count() > 0)
					{
						ViewData[ProfilConstants.DelFavorite] = true;
					}
					else
					{
						ViewData[ProfilConstants.AddToFavorite] = true;
					}
				}
			}
		}
			<div id="fb-root">
			</div>
			<script src="http://connect.facebook.net/fr_FR/all.js#xfbml=1"></script>
			<fb:like href="@link" layout="button_count" show_faces="false" font="arial" style="vertical-align: top;">
			</fb:like>
			<!-- Placez cette balise à l'endroit où vous souhaitez que le bouton +1 s'affiche --> 
			<g:plusone size="medium" href="@link"></g:plusone>                       
			<a  href="http://twitter.com/share" 
				class="twitter-share-button"
				data-text="@String.Format(Worki.Resources.Views.Localisation.LocalisationString.Recommendation, fullName)" 
				data-count="horizontal" 
				data-via="eWorky"
				data-counturl="@link">
					@Worki.Resources.Views.Localisation.LocalisationString.Tweet</a>
			<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>  
			<div id="favLink">
				@Html.Partial(MVC.Shared.Views._AddToFavorite)
			</div>              
		</div>
		<div class="clear">
		</div>
	</div>
	<div class="detailContent">
		<div class="detailTabs localisationDetailLeft blockContainer float-left">
			<div class="contentBlock">
				<div class="horizontalMenu">
					<ul class="detailTab">
						<li><a href="#overview" class="bold">Vue d'ens</a></li>
						<li><a href="#acces" class="bold">Accès</a></li>
						<li><a href="#offers" class="bold">Offres</a></li>
						<li><a href="#community" class="bold">Communauté</a></li>
					</ul>
				</div>
				<div class="detailTabContent tab_container">
					<div id="overview" class="tab_content">
						@if (Model.LocalisationFiles.Count > 0)
						{
						<div class="localisationGallery">
							<div class="gallery">
								@foreach (var item in Model.LocalisationFiles.OrderBy(f => !f.IsDefault))
								{
									<a href="@ControllerHelpers.GetUserImagePath(item.FileName)" class="hidden">
            							<img title="@fullName" alt="@fullName" src="@ControllerHelpers.GetUserImagePath(item.FileName)" itemprop="image"/>
        							</a>                        
								}
							</div>
						</div>
						}
						@{
							var generalFeatures = Model.GetFeaturesWithin(FeatureHelper.Characteristics);
							var workingPlaceFeatures = Model.GetFeaturesWithin(FeatureHelper.Services);
						}
						<div class="localisationDescription margint10">
							<div class="localisationDesc" itemprop="description">
								@Html.Nl2Br(Model.GetDescription())
							</div>
							@if (generalFeatures.Count > 0)
							{
								<h4 class="orange servicesBlock">@Worki.Resources.Views.Localisation.LocalisationString.Equipments</h4>
								<div class="featureTag">
									<ul>
									@foreach (var item in generalFeatures)
									{
										<li>@FeatureHelper.Display(item)</li>
									}       
									</ul>
								</div>
								<div class="clear">
								</div>
							}
							@if (workingPlaceFeatures.Count > 0)
							{
								<h4 class="orange servicesBlock margint10">@Worki.Resources.Views.Shared.SharedString.Services</h4>
								<div class="featureTag">
									<ul>
									@foreach (var item in workingPlaceFeatures)
									{
										<li>@FeatureHelper.Display(item)</li>
									}
									</ul>
								</div> 
								<div class="clear">
								</div>
							}
						</div>
					</div>
					<div id="acces" class="tab_content">
						<div class="localisationMap">
							@Html.Partial(MVC.Shared.Views._Map, Model.GetMapModel())
						</div>
						@if (Model.HasAccesField())
						{
							<h3 class="blue margint10">@Worki.Resources.Views.Localisation.LocalisationFormString.Access</h3>
							<div class="localisationAccessDetail">
							@if (!string.IsNullOrEmpty(Model.PublicTransportation))
							{
								<span class="bold">@Worki.Resources.Models.Localisation.Localisation.PublicTransportation : </span>
								@Model.PublicTransportation<br />
							}
							@if (!string.IsNullOrEmpty(Model.RoadAccess))
							{
								<span class="bold">@Worki.Resources.Models.Localisation.Localisation.RoadAccess : </span>
								@Model.RoadAccess<br />
							}
							@if (!string.IsNullOrEmpty(Model.Station))
							{
								<span class="bold">@Worki.Resources.Models.Localisation.Localisation.Station : </span>
								@Model.Station<br />
							}
							</div>
						}
					
						<h3 class="blue margint10">@Worki.Resources.Views.Localisation.LocalisationString.Schedule</h3>
						@if (Model.HasFeature(Feature.Access24))
						{
							@Html.FeatureLabelFor(Feature.Access24, Model)
						}
						else if (Model.HasOpenningTimes())
						{
						<table>
							@RazorHelpers.OpenningRow(Model, DayOfWeek.Monday, Worki.Resources.Views.Localisation.LocalisationFormString.Monday)
							@RazorHelpers.OpenningRow(Model, DayOfWeek.Tuesday, Worki.Resources.Views.Localisation.LocalisationFormString.Tuesday)
							@RazorHelpers.OpenningRow(Model, DayOfWeek.Wednesday, Worki.Resources.Views.Localisation.LocalisationFormString.Wednesday)
							@RazorHelpers.OpenningRow(Model, DayOfWeek.Thursday, Worki.Resources.Views.Localisation.LocalisationFormString.Thursday)
							@RazorHelpers.OpenningRow(Model, DayOfWeek.Friday, Worki.Resources.Views.Localisation.LocalisationFormString.Friday)
							@RazorHelpers.OpenningRow(Model, DayOfWeek.Saturday, Worki.Resources.Views.Localisation.LocalisationFormString.Saturday)
							@RazorHelpers.OpenningRow(Model, DayOfWeek.Sunday, Worki.Resources.Views.Localisation.LocalisationFormString.Sunday)
						</table>
						}
						else
						{
							@Worki.Resources.Views.Shared.SharedString.KnowHouly @MiscHelpers.EmailConstants.ContactMail
						}
					</div>
					<div id="offers" class="tab_content">
						<div class="offerTabs">
							<div class="detailMenu">
								<ul class="offerTab float-left">
									<li><a href="#buisnessLounge">Salon d'affaire</a></li>
									<li class="detailMenuEmpty"></li>
									<li><a href="#workstation">Postes de travail</a></li>
									<li class="detailMenuEmpty"></li>
									<li><a href="#desktop">Bureaux</a></li>
									<li class="detailMenuEmpty"></li>
									<li><a href="#meetingRoom">Salle de réunion</a></li>
									<li class="detailMenuEmpty"></li>
									<li><a href="#seminarRoom">Salle de séminaire</a></li>
									<li class="detailMenuEmpty"></li>
									<li><a href="#visioRoom">Salle de visio</a></li>
								</ul>
							</div>
							<div class="tab_container offerTabContainer float-right">
								<div id="buisnessLounge" class="offerTab_content">
									@OfferBlock(Model, LocalisationOffer.BuisnessLounge)
								</div>
								<div id="workstation" class="offerTab_content">
									@OfferBlock(Model, LocalisationOffer.Workstation)
								</div>
								<div id="desktop" class="offerTab_content">
									@OfferBlock(Model, LocalisationOffer.Desktop)
								</div>
								<div id="meetingRoom" class="offerTab_content">
									@OfferBlock(Model, LocalisationOffer.MeetingRoom)
								</div>
								<div id="seminarRoom" class="offerTab_content">
									@OfferBlock(Model, LocalisationOffer.SeminarRoom)
								</div>
								<div id="visioRoom" class="offerTab_content">
									@OfferBlock(Model, LocalisationOffer.VisioRoom)
								</div>
							</div>
							<div class="clear"></div>
						</div>
					</div>
					<div  id="community" class="tab_content localisationComments">
                        <div class="communityTabs">
							<div class="detailMenu">
								<ul class="communityTab float-left">
									<li><a href="#comments">@Worki.Resources.Models.Localisation.Localisation.GiveYourAdvice</a></li>
									<li class="detailMenuEmpty"></li>
									<li><a href="#eworkers">eWorkers</a></li>
									<li class="detailMenuEmpty"></li>
									<li><a href="#social">Réseaux sociaux</a></li>
								</ul>
							</div>
							<div class="tab_container communityTabContainer float-right">
								<div id="comments" class="communityTab_content">
									<div id="commentFormDiv">
							            @if (Request.IsAuthenticated)
							            {
								            @Html.Partial(MVC.Localisation.Views._CommentForm, new Comment { LocalisationID = Model.ID, Localisation = Model })
							            }
							            else
							            {	
								            @Html.ActionLink(Worki.Resources.Views.Account.AccountString.Login, MVC.Account.LogOn(null, Request.RawUrl), new { @class = "orange" })
							            }
						            </div>
						            @{
							            ViewData[Comment.DisplayRelatedLocalisation] = false;
						            }
						            @foreach (var com in Model.GetOrderedComments(Url.GetCulture()))
						            {
							            if (com.Member == null)
							            {
								            continue;
							            }
							            @Html.Partial(MVC.Shared.Views._LocalisationSingleComment, com, ViewData)
						            }
								</div>
								<div id="eworkers" class="communityTab_content">
									plop
								</div>
								<div id="social" class="communityTab_content">
									plop
								</div>
							</div>
							<div class="clear"></div>
						</div>
					</div>
				</div>
				<div class="clear">
				</div>
			</div>
		</div>
		<div class="localisationDetailRight blockContainer float-right">
			<div class="">
				@Html.Partial(MVC.Localisation.Views._LocalisationInfos)
			</div>		
		</div>
		<div class="clear">
		</div>
	</div>
</div>

<div class="margint10">
	<div class="buttonStd buttonBlue linkImg float-right">
	@Html.ActionLink(Worki.Resources.Views.Localisation.LocalisationString.EditPlace, MVC.Localisation.Edit(Model.ID))
	</div>
	@if (Roles.IsUserInRole(MiscHelpers.AdminConstants.AdminRole))
	{
		<div class="buttonStd buttonBlue linkImg float-right">
		@Html.ActionLink(Worki.Resources.Views.Localisation.LocalisationString.DeletePlace, MVC.Admin.Sheet.DeleteLocalisation(Model.ID))
		</div>
	}
	<div class="clear">
	</div>
</div>

