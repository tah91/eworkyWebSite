@model Worki.Data.Models.SearchCriteriaFormViewModel

@section HeadContent
{
    <meta name="robots" content="noindex">
    <title>@Html.WorkiTitle(Worki.Resources.Views.Search.SearchString.SearchResult)</title>
    <link href="@Url.VersionedContent(Links.Content.Search_min_css)" rel="stylesheet" type="text/css" />
	<link href="@Url.VersionedContent(Links.Content.LocalisationDetail_min_css)" rel="stylesheet" type="text/css" />
    <link href="@Url.VersionedContent(Links.Content.skin_min_css)" rel="stylesheet" type="text/css"  />
    <link href="@Url.VersionedContent(Links.Content.rateit_min_css)" rel="stylesheet" type="text/css" />
    <link href="@Url.VersionedContent(Links.Content.jquery_ui_1_8_12_custom_min_css)" rel="stylesheet" type="text/css"/>
}

@{
	RouteValueDictionary rvd = new RouteValueDictionary(ViewContext.RouteData.Values);
	foreach (string key in Request.QueryString.Keys)
	{
		rvd[key] = Request.QueryString[key].ToString();
	}
}

<div class="float-left">
    @RazorHelpers.TitleDiv(string.Format(Worki.Resources.Views.Search.SearchString.YourSearchResult, Model.Results.Count), "Blue")
</div>
<div class="float-right">
    <div class="buttonStd buttonBlue linkImg inline-block">
        @Html.ActionLink(Worki.Resources.Views.Search.SearchString.DistanceOrdered, MVC.Localisation.ActionNames.FullSearchResult, rvd.GetOrderCrit(eOrderBy.Distance))
    </div>
    <div class="buttonStd buttonBlue linkImg inline-block">
        @Html.ActionLink(Worki.Resources.Views.Search.SearchString.RateOrdered, MVC.Localisation.ActionNames.FullSearchResult, rvd.GetOrderCrit(eOrderBy.Rating))
    </div>
</div>
<div class="clear"></div>

<div class="detailContent">
    <div class="searchFormBlock float-right">
		<div class="contentBlock">
			<div class="resultsMapDiv">
                <span class="blue">@Worki.Resources.Views.Search.SearchString.ResultOnMap</span>
                <div class="mapContainer" id="resultsMap">
                </div>
            </div> 
        
            <div class="searchResultFormDiv" id="searchFormReset">
                <h3 class="blue">@Worki.Resources.Views.Search.SearchString.RefineSearch</h3>
                @using (Html.BeginForm(MVC.Localisation.ActionNames.FullSearch, MVC.Localisation.Name, FormMethod.Post, new { id = "searchform" }))
                {
                    @Html.AntiForgeryToken()
					@Html.HiddenFor(model => model.Criteria.LocalisationData.Latitude)
                    @Html.HiddenFor(model => model.Criteria.LocalisationData.Longitude)
                    <h4 class="toogle_item toogle_trigger toogle_trigger_click"><span class="blue">@Worki.Resources.Views.Localisation.LocalisationString.Localisation</span></h4>
                    <div class="toogle_container">
                        <div class="block">
                            <div class="editor-field">
                                @Html.TextBoxFor(model => model.Criteria.Place)
                                @Html.ValidationMessage(Worki.Resources.Views.Home.HomeString.Location, "")
                            </div>
                        </div>
                    </div>
                    
                    <h4 class="toogle_item toogle_trigger toogle_trigger_click"><span class="blue">@Worki.Resources.Views.Localisation.LocalisationFormString.Offers</span></h4>
                    <div class="toogle_container">
                        <div class="block">
                            <div class="editor-field">
                                @Html.DropDownList("Criteria.LocalisationOffer", Model.Offers, new { @class = "offerSelect" })
                                @Html.ValidationMessage("LocalisationOffer", "")
                            </div>
                        </div>
		            </div>

                    <h4 class="toogle_item toogle_trigger toogle_trigger_click"><span class="blue">@Worki.Resources.Views.Localisation.LocalisationFormString.Facilities</span></h4>
                    <div class="toogle_container">
                        <div class="block">
                            @Html.Partial(MVC.Localisation.Views._ServicesSelector)
                        </div>
                    </div>
                    
                    <h4 class="toogle_item toogle_trigger toogle_trigger_click"><span class="blue">@Worki.Resources.Views.Search.SearchString.KindOfLocation</span></h4>
                    <div class="toogle_container">
                        <div class="block">
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.Everything)
                                @Html.LabelFor(model => model.Criteria.Everything)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.SpotWifi)
                                @Html.LabelFor(model => model.Criteria.SpotWifi)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.CoffeeResto)
                                @Html.LabelFor(model => model.Criteria.CoffeeResto)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.Biblio)
                                @Html.LabelFor(model => model.Criteria.Biblio)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.PublicSpace)
                                @Html.LabelFor(model => model.Criteria.PublicSpace)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.TravelerSpace)
                                @Html.LabelFor(model => model.Criteria.TravelerSpace)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.Hotel)
                                @Html.LabelFor(model => model.Criteria.Hotel)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.Telecentre)
                                @Html.LabelFor(model => model.Criteria.Telecentre)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.BuisnessCenter)
                                @Html.LabelFor(model => model.Criteria.BuisnessCenter)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.CoworkingSpace)
                                @Html.LabelFor(model => model.Criteria.CoworkingSpace)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.WorkingHotel)
                                @Html.LabelFor(model => model.Criteria.WorkingHotel)
                            </div>
                            <div class="editor-field">
                                @Html.CheckBoxFor(model => model.Criteria.PrivateArea)
                                @Html.LabelFor(model => model.Criteria.PrivateArea)
                            </div>
                        </div>
                    </div>

                    <h4 class="toogle_item toogle_trigger toogle_trigger_click"><span class="blue">@Worki.Resources.Views.Localisation.LocalisationFormString.Services</span></h4>
                    <div class="toogle_container">
                        <div class="block">
                            <div>
                                <div id="searchOption0">
                                    <div id="searchOptionToReplace">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="resetSearch">
                        <input type="submit" class="buttonBlue buttonStd imageBtn" value="@Worki.Resources.Views.Shared.SharedString.Reset"/>
                    </div>
				}
            </div>
		</div>
    </div>

    <div class="resultDiv dashedRight float-left">
        <div class="searchFormBlockLeft">
            @for (int i = 0; i < Model.PageResults.Count; ++i)
			{
				var index = Model.PagingInfo.GlobalIndex(i);
                @Html.Partial(MVC.Localisation.Views._SearchResultSummary, Model.GetSingleResult(index))
			}

			<div class="pager">
				@Html.PageLinks(Model.PagingInfo, x => {
                                                        rvd["page"] = x;
                                                        var url = Context.Request.RawUrl.Split('/');
                                                        if (url[url.Length - 1] == "1")
                                                        {
                                                            rvd["order"] = (int)eOrderBy.Distance;
                                                        }
                                                        else
                                                        {
                                                            rvd["order"] = (int)eOrderBy.Rating;
                                                        }
                                                        return Url.Action(MVC.Localisation.ActionNames.FullSearchResult, rvd);
                                                        })
			</div>
        </div>    
    </div>

	<div class="clear">
    </div>
</div>

<div class="adRow">
    @Html.Partial(MVC.Localisation.Views._DirectAccess)
    @Html.Partial(MVC.Shared.Views._IndexGallery)
</div>

@section ScriptContent
{
    <script type="text/javascript">
        require(["@Url.VersionedContent(Links.Scripts.tabs_js)"]);
        require(["@Url.VersionedContent(Links.Scripts.jquery_rateit_js)"]);
        require(["@MiscHelpers.UrlConstants.jqueryui", "http://maps.google.com/maps/api/js?sensor=true&region=FR&callback=initialize"], function () {

        });

        function initialize() {
            require(["@Url.VersionedContent(Links.Scripts.WorkiMap_js)"], function () {
                var resultsMap = new WorkiMap('resultsMap');
                var where = "@Model.Criteria.Place";
                resultsMap.LoadSearchMap(where);
                var bounds = new google.maps.LatLngBounds();
				function addMarker(latitude, longitude, name)
				{
                    var LL = new google.maps.LatLng(latitude,longitude);
                    resultsMap.LoadPin(LL, name);
                    bounds.extend(LL);
				}
                @foreach (var localisation in Model.PageResults)
				{
					@:addMarker(@localisation.Latitude, @localisation.Longitude, "@Html.Raw(localisation.Name)");
                }
                @if (Model.PageResults.Count >= 2)
				{
                    <text>
                    resultsMap.FitBoundsSearchResults(bounds);
                    </text>
				}
                var workiAutocomplete = new WorkiAutoComplete('#Criteria_Place');
                workiAutocomplete.SetAutocomplete();
            });   
        }
    </script>
    @{ ViewData["IsSearchForm"] = true; }
    @Html.Partial(MVC.Localisation.Views._SelectSearchScript, Model.Criteria.LocalisationData, ViewData)
    @Html.Partial(MVC.Shared.Views._IndexGalleryScript)
}
