@model Worki.Data.Models.SearchCriteriaFormViewModel

<div class="resultsMapDiv">
    <h3 class="blue">@Worki.Resources.Views.Search.SearchString.ResultOnMap</h3>
    <div class="mapContainer" id="resultsMap">
    </div>
</div> 
        
<div class="searchResultFormDiv" id="searchFormReset">
    <h3 class="green">@Worki.Resources.Views.Search.SearchString.RefineSearch</h3>
    @using (Html.BeginForm(MVC.Search.ActionNames.FullSearch, MVC.Search.Name, FormMethod.Post, new { id = "searchform" }))
    {
        @Html.AntiForgeryToken()
        <div class="editor-field">
            @Html.TextBoxFor(model => model.Criteria.Place)
            @Html.ValidationMessage(Worki.Resources.Views.Home.HomeString.Location, "")
        </div>

        <p>
            @Html.HiddenFor(model => model.Criteria.LocalisationData.Latitude)
            @Html.HiddenFor(model => model.Criteria.LocalisationData.Longitude)
        </p>
        
        <p class="green">@Worki.Resources.Views.Localisation.LocalisationFormString.Offers</p>
        <div class="editor-field">
            @Html.DropDownList("Criteria.LocalisationOffer", Model.Offers, new { @class = "offerSelect" })
            @Html.ValidationMessage("LocalisationOffer", "")
        </div>

        <p class="green">@Worki.Resources.Views.Localisation.LocalisationFormString.Facilities</p>
        @Html.Partial(MVC.Search.Views._ServicesSelector)
        <p class="green">@Worki.Resources.Views.Search.SearchString.KindOfLocation</p>
        <div class="editor-field">
        @Html.CheckBoxFor(model => model.Criteria.Everything)
        @Html.LabelFor(model => model.Criteria.Everything)
        </div>
        <div class="editor-field">
        @Html.CheckBoxFor(model => model.Criteria.SpotWifi)
        @Html.LabelFor(model => model.Criteria.SpotWifi)
        </div>
        <div class="editor-field">
        @Html.CheckBoxFor(model => model.Criteria.CoffeeResto)
        @Html.LabelFor(model => model.Criteria.CoffeeResto)
        </div>
        <div class="editor-field">
        @Html.CheckBoxFor(model => model.Criteria.Biblio)
        @Html.LabelFor(model => model.Criteria.Biblio)
        </div>
        <div class="editor-field">
        @Html.CheckBoxFor(model => model.Criteria.PublicSpace)
        @Html.LabelFor(model => model.Criteria.PublicSpace)
        </div>
        <div class="editor-field">
        @Html.CheckBoxFor(model => model.Criteria.TravelerSpace)
        @Html.LabelFor(model => model.Criteria.TravelerSpace)
        </div>
        <div class="editor-field">
        @Html.CheckBoxFor(model => model.Criteria.Hotel)
        @Html.LabelFor(model => model.Criteria.Hotel)
        </div>
        <div class="editor-field">
        @Html.CheckBoxFor(model => model.Criteria.Telecentre)
        @Html.LabelFor(model => model.Criteria.Telecentre)
        </div>
        <div class="editor-field">
        @Html.CheckBoxFor(model => model.Criteria.BuisnessCenter)
        @Html.LabelFor(model => model.Criteria.BuisnessCenter)
        </div>
        <div class="editor-field">
        @Html.CheckBoxFor(model => model.Criteria.CoworkingSpace)
        @Html.LabelFor(model => model.Criteria.CoworkingSpace)
        </div>
        <div class="editor-field">
        @Html.CheckBoxFor(model => model.Criteria.WorkingHotel)
        @Html.LabelFor(model => model.Criteria.WorkingHotel)
        </div>
        <div class="editor-field">
        @Html.CheckBoxFor(model => model.Criteria.PrivateArea)
        @Html.LabelFor(model => model.Criteria.PrivateArea)
        </div>

        <p class="green">@Worki.Resources.Views.Localisation.LocalisationFormString.Services</p>
        <div>
            <div id="searchOption0">
                <div id="searchOptionToReplace">
                </div>
            </div>
        </div>
        <div class="resetSearch">
            <input type="submit" class="btn_green_check imageBtn" value="Réinitialiser"/>
        </div>

    }
</div>

<script src="http://maps.google.com/maps/api/js?sensor=true&region=FR" type="text/javascript"></script>
<script src="@MiscHelpers.jquery" type="text/javascript"></script>
<script src="@Url.Script(Links.Scripts.WorkiMap_js)" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {
        //do it on server side
//        $('#searchform').submit(function (evt) {
//            var workiGeoCoder = new WorkiGeocoder('#Criteria_LocalisationData_Latitude', '#Criteria_LocalisationData_Longitude', '#Criteria_Place', this, evt);
//            workiGeoCoder.SearchFormSubmit();
//        });

        var resultsMap = new WorkiMap('resultsMap');
        resultsMap.LoadSearchMap();
        var where = "@Model.Criteria.Place";
        resultsMap.CenterSearchResults(where);
        var latitude = null;
        var longitude = null;
        var nom = null;
        var desc = null;
        var LL = null;
        var bounds = new google.maps.LatLngBounds();
        @foreach (var localisation in Model.PageResults)
        {
            <text>
            latitude = @localisation.Latitude;
            longitude = @localisation.Longitude;
            nom = "@localisation.Name";
            LL = new google.maps.LatLng(latitude,longitude);
            resultsMap.LoadPin(LL, nom);
            bounds.extend(LL);
            </text>
        }
        @if (Model.PageResults.Count >= 2)
        {
            <text>
            resultsMap.FitBoundsSearchResults(bounds);
            </text>
        }
    });
</script>