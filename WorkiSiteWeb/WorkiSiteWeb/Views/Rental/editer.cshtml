@model Worki.Data.Models.RentalFormViewModel

@section HeadContent
{
	<title>@Html.WorkiTitle(Model.Rental.Id == 0 ? Worki.Resources.Views.Rental.RentalString.AddRental :  Worki.Resources.Views.Rental.RentalString.EditRental)</title>
	<link href="@Url.VersionedContent(Links.Content.RentalForm_min_css)" rel="stylesheet" type="text/css" />
    <link href="@Url.VersionedContent(Links.Content.RentalDetail_min_css)" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/themes/base/jquery-ui.css" id="theme">
    <link rel="stylesheet" href="@Url.VersionedContent(Links.Content.jquery_fileupload_ui_min_css)" />
    <link href="@Url.VersionedContent(Links.Content.jquery_ui_1_8_12_custom_min_css)" rel="stylesheet" type="text/css"/>
}

@RazorHelpers.TitleDiv((Model.Rental.Id == 0 ? Worki.Resources.Views.Rental.RentalString.AddRental : Worki.Resources.Views.Rental.RentalString.EditRental), "Red")

@using (Html.BeginForm(MVC.Rental.ActionNames.Edit, MVC.Rental.Name, FormMethod.Post, new { enctype = "multipart/form-data", id = "rentalForm" }))
{
	@Html.AntiForgeryToken()
	<div class="detailContent">
		<div class="blockContainer">
			<div class="contentBlock">
				<h3 class="red inline">@Worki.Resources.Views.Rental.RentalString.Infos</h3>
                <span>&nbsp;&nbsp;(<span class="red">*</span>@Worki.Resources.Views.Localisation.LocalisationFormString.MandatoryFields)</span>
				<table class="generalInfosTable tableEdit">
					<tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.Type)<span class="red">*</span>
							</div>
						</td>
						<td>
							<div class="editor-field">
								@Html.DropDownListFor(m => m.Rental.Type, Model.RentalTypeSelect)
							</div>
						</td>
					</tr>
					<tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.Reference)
							</div>
						</td>
						<td>
							<div class="editor-field">
								@Html.TextBoxFor(m => m.Rental.Reference, new { placeHolder = "Ex : Immo03/2011, RAMBUTEAU-03" })
							</div>
						</td>
					</tr>
					<tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.LeaseType)<span class="red">*</span>
							</div>
						</td>
						<td>
							<div class="editor-field">
								@Html.DropDownListFor(m => m.Rental.LeaseType, Model.LeaseTypeSelect)
							</div>
						</td>
					</tr>
					<tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.AvailableNow)<span class="red">*</span>
							</div>
						</td>
						<td>
							<div class="editor-label">
							@Html.CheckBoxFor(m => m.Rental.AvailableNow)
							</div>
						</td>
					</tr>
					<tr>
						<td>
							<div class="editor-label" id="labeldate">
								@Html.LabelFor(m => m.Rental.AvailableDate)
							</div>
						</td>
						<td>
							<div class="editor-field">
								@Html.TextBoxFor(m => m.Rental.AvailableDate, new { @class = "dp", placeholder = Worki.Resources.Views.Rental.RentalString.DateExample })
							</div>
						</td>
					</tr>
					<tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.Rate) (€)
							</div>
						</td>
						<td>
							<div class="editor-field">
								@Html.TextBoxFor(m => m.Rental.Rate, new { placeHolder = "Ex : 3000" })
							</div>
						</td>
					</tr>
					<tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.Charges) (€)
							</div>
						</td>
						<td>
							<div class="editor-field">
								@Html.TextBoxFor(m => m.Rental.Charges, new { placeHolder = "Ex : 400" })
							</div>
						</td>
					</tr>
					<tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.Surface) (m2)
							</div>
						</td>
						<td>
							<div class="editor-field">
								@Html.TextBoxFor(m => m.Rental.Surface, new { placeHolder = "Ex : 250" })
							</div>
						</td>
					</tr>
                    <tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.HeatingType)
							</div>
						</td>
						<td>
							<div class="editor-field">
								@Html.DropDownListFor(m => m.Rental.HeatingType, Model.HeatingTypeSelect)
							</div>
						</td>
					</tr>
                    <tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.GreenHouse)
							</div>
						</td>
						<td>
							<div class="editor-field">
								@Html.DropDownListFor(m => m.Rental.GreenHouse, Model.DiagnosticRateSelect)
							</div>
						</td>
					</tr>
				</table>
			</div>
			<div class="contentBlock">
				<h3 class="red">@Worki.Resources.Views.Rental.RentalString.Description</h3>
				@Html.TextAreaFor(m => m.Rental.Description)
			</div> 
			<div class="contentBlock">
				<h3 class="red">@Worki.Resources.Views.Rental.RentalString.Access</h3>
				<table class="generalInfosTable tableEdit">
					<tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.Address)
							</div>
						</td>
						<td>
							<div class="editor-field">
								@Html.TextBoxFor(m => m.Rental.Address, new { placeHolder = "Ex : 9 rue de Lille" })
							</div>
						</td>
					</tr>
					<tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.PostalCode)
							</div>
						</td>
						<td>
							<div class="editor-label">
							@Html.TextBoxFor(m => m.Rental.PostalCode, new { placeHolder = "Ex : 75007" })
							</div>
						</td>
					</tr>
					<tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.City)
							</div>
						</td>
						<td>
							<div class="editor-field">
								@Html.TextBoxFor(m => m.Rental.City, new { placeHolder = "Ex : Paris" })
							</div>
						</td>
					</tr>
                    <tr>
						<td>
							<div class="editor-label">
								@Html.LabelFor(m => m.Rental.Country)
							</div>
						</td>
						<td>
							<div class="editor-field">
								@Html.TextBoxFor(m => m.Rental.Country, new { placeHolder = "Ex : France" })
							</div>
						</td>
					</tr>
				</table>
                <h3 class="red margint10">@Worki.Resources.Views.Rental.RentalString.CommonTransportAccess</h3>
				<div class="rentalAccessRows">
					@foreach (var item in Model.Rental.RentalAccesses)
     {
						 @Html.Partial(MVC.Rental.Views._RentalAccess, item)
     }
				</div>
				@Html.ActionLink(Worki.Resources.Views.Rental.RentalString.AddAnother, "AddRentalAccess", null, new { id = "addItem" })
			</div> 
			<div class="contentBlock">
				<h3 class="red">@Worki.Resources.Views.Rental.RentalString.Images</h3>
				<div id="fileupload" class="borderRadius">
					<div class="fileupload-buttonbar">
						<label class="fileinput-button">
							<span>@Worki.Resources.Views.Localisation.LocalisationString.AddPicture</span>
							<input type="file" name="files[]" accept="image/*"/>
						</label>
					</div>
					<div class="fileupload-content">
						<table class="files"></table>
						<div class="fileupload-progressbar"></div>
					</div>
				</div>
			</div>
			<div class="contentBlock">
				<h3 class="red">@Worki.Resources.Views.Rental.RentalString.Features</h3>
				<ul class="marginl0">
                @{var count = 0;}
					@foreach (var feature in Rental.RentalFeatureDict)
					 {
                         if (count % 2 == 0)
                         {
						     <li class="float-left leftLiFeature">
							    @{var enumName = Enum.GetName(typeof(RentalFeatureType), feature.Key);}
							    @Html.CheckBox(enumName, Model.Rental.HasFeature((RentalFeatureType)feature.Key))
							    @Html.LabelFor(feature.Value, enumName)
						     </li>
                         }
                         else
                         {
                            <li>
						        @{var enumName = Enum.GetName(typeof(RentalFeatureType), feature.Key);}
						        @Html.CheckBox(enumName, Model.Rental.HasFeature((RentalFeatureType)feature.Key))
						        @Html.LabelFor(feature.Value, enumName)
						    </li>
                            <div class="clear"></div>
                         }
                         count++;
                     }
				</ul>
			</div> 
			<div class="submitAddButton float-right">
				<input  type="submit" class="buttonStd buttonRed imageBtn" value="@Worki.Resources.Views.Rental.RentalString.Submit"/>
			</div>
			<div class="clear">
			</div>
		</div>
	</div>
}


@section ScriptContent
{
	<script type="text/javascript">

	    require(["@MiscHelpers.UrlConstants.jqueryui", "@Url.VersionedContent(Links.Scripts.jquery_ui_datepicker_fr_js)"], function () {
	        $(".dp").datepicker({
	            changeMonth: true,
	            changeYear: true,
	            yearRange: '1900:2020'
	        });
	    });

		require.ready(function () {
			$("#addItem").click(function () {
				$.ajax({
					url: this.href,
					cache: false,
					success: function (html) { $(".rentalAccessRows").append(html); }
				});
				return false;
			});

			$("button.deleteRow").live("click", function () {
				$(this).parents(".rentalAccessRow:first").remove();
				return false;
			});
		});

        $("#Rental_AvailableNow").click(function () {
            if ($("#Rental_AvailableNow:checked").val() == "true") {
                $("#Rental_AvailableDate").hide();
                $("#labeldate").hide();
            }
            else {
                $("#Rental_AvailableDate").show();
                $("#labeldate").show();
            }
        });

        function init() {
            if ($("#Rental_AvailableDate").attr("value") == null || $("#Rental_AvailableNow:checked").val() == "true") {
                $("#Rental_AvailableDate").hide();
                $("#labeldate").hide();
            }
            if ($("#Rental_Rate").attr("value") == 0)
                $("#Rental_Rate").attr("value", null);
            if ($("#Rental_Charges").attr("value") == 0)
                $("#Rental_Charges").attr("value", null);
            if ($("#Rental_Surface").attr("value") == 0)
                $("#Rental_Surface").attr("value", null);
        };

        $(document).ready(function () {
            init();
        });

        require(["@MiscHelpers.UrlConstants.jqueryui", "@Url.VersionedContent(Links.Scripts.jquery_ui_autocomplete_selectFirst_js)", "@Url.VersionedContent(Links.Scripts.WorkiAutocomplete_js)"], function () {
            var cityAutocomplete = new WorkiCityAutoComplete('#Rental_City');
            cityAutocomplete.SetAutocomplete();
        });
	</script>
    @Html.Partial(MVC.Shared.Views._UploadGalleryScript, Model.Rental)
}