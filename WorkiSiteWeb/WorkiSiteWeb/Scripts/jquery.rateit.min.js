(function(a){function b(c){var g=c.originalEvent.changedTouches[0],d="";switch(c.type){case"touchmove":d="mousemove";break;case"touchend":d="mouseup";break;default:return}var h=document.createEvent("MouseEvent");h.initMouseEvent(d,true,true,window,1,g.screenX,g.screenY,g.clientX,g.clientY,false,false,false,false,0,null);g.target.dispatchEvent(h);c.preventDefault()}a.fn.rateit=function(c,g){var d={},h="init";if(this.length==0){return this}var i=a.type(c);if(i=="object"||c===undefined||c==null){d=a.extend({},a.fn.rateit.defaults,c)}else{if(i=="string"&&g===undefined){return this.data("rateit-"+c)}else{if(i=="string"){h="setvalue"}}}return this.each(function(){var j=a(this),e=function(n,o){return j.data("rateit-"+n,o)};j.hasClass("rateit")||j.addClass("rateit");var l=j.css("direction")!="rtl";if(h=="setvalue"){if(!e("init")){throw"Can't set value before init"}if(c=="readonly"&&!e("readonly")){j.find(".rateit-range").unbind();e("wired",false)}if(e("backingfld")){var f=a(e("backingfld"));c=="value"&&f.val(g);if(c=="min"&&f[0].min){f[0].min=g}if(c=="max"&&f[0].max){f[0].max=g}if(c=="step"&&f[0].step){f[0].step=g}}e(c,g)}if(!e("init")){e("min",e("min")||d.min);e("max",e("max")||d.max);e("step",e("step")||d.step);e("readonly",e("readonly")!==undefined?e("readonly"):d.readonly);e("resetable",e("resetable")!==undefined?e("resetable"):d.resetable);e("backingfld",e("backingfld")||d.backingfld);e("starwidth",e("starwidth")||d.starwidth);e("starheight",e("starheight")||d.starheight);e("value",e("value")||d.min);if(e("backingfld")){f=a(e("backingfld"));e("value",f.hide().val());if(f[0].nodeName=="INPUT"){if(f[0].type=="range"||f[0].type=="text"){e("min",parseInt(f.attr("min"))||e("min"));e("max",parseInt(f.attr("max"))||e("max"));e("step",parseInt(f.attr("step"))||e("step"))}}if(f[0].nodeName=="SELECT"&&f[0].options.length>1){e("min",Number(f[0].options[0].value));e("max",Number(f[0].options[f[0].length-1].value));e("step",Number(f[0].options[1].value)-Number(f[0].options[0].value))}}j.append('<div class="rateit-reset"></div><div class="rateit-range"><div class="rateit-selected" style="height:'+e("starheight")+'px"></div><div class="rateit-hover" style="height:'+e("starheight")+'px"></div></div>');if(!l){j.find(".rateit-reset").css("float","right");j.find(".rateit-selected").addClass("rateit-selected-rtl");j.find(".rateit-hover").addClass("rateit-hover-rtl")}e("init",true)}var k=j.find(".rateit-range");k.width(e("starwidth")*(e("max")-e("min"))).height(e("starheight"));if(e("value")){var m=(e("value")-e("min"))*e("starwidth");j.find(".rateit-selected").width(m)}f=j.find(".rateit-reset");var q=function(n,o){var p=(o.changedTouches?o.changedTouches[0].pageX:o.pageX)-a(n).offset().left;l||(p=k.width()-p);if(p>k.width()){p=k.width()}if(p<0){p=0}return m=Math.ceil(p/e("starwidth")*(1/e("step")))};if(e("readonly")){f.hide()}else{e("resetable")?f.click(function(){e("value",e("min"));k.find(".rateit-hover").hide().width(0);k.find(".rateit-selected").width(0).show();e("backingfld")&&a(e("backingfld")).val(e("min"));j.trigger("reset")}):f.hide();if(!e("wired")){k.bind("touchmove touchend",b);k.mousemove(function(n){n=q(this,n);var o=n*e("starwidth")*e("step"),p=k.find(".rateit-hover");if(p.data("width")!=o){k.find(".rateit-selected").hide();p.width(o).show().data("width",o);j.trigger("hover",[n*e("step")+e("min")])}});k.mouseleave(function(){k.find(".rateit-hover").hide().width(0).data("width","");j.trigger("hover",[null]);k.find(".rateit-selected").show()});k.mouseup(function(n){n=q(this,n);var o=n*e("step")+e("min");e("value",o);e("backingfld")&&a(e("backingfld")).val(o);k.find(".rateit-hover").hide();k.find(".rateit-selected").width(n*e("starwidth")*e("step")).show();j.trigger("hover",[null]).trigger("rated",[o])});e("wired",true)}e("resetable")&&f.show()}})};a.fn.rateit.defaults={min:0,max:5,step:0.5,starwidth:16,starheight:16,readonly:false,resetable:true};a("div.rateit").rateit()})(jQuery);