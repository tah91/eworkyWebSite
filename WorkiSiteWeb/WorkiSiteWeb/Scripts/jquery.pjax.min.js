(function(a){a.fn.pjax=function(d,e){if(e){e.container=d}else{e=a.isPlainObject(d)?d:{container:d}}if(typeof e.container!=="string"){throw"pjax container must be a string selector!";return false}return this.live("click",function(g){if(g.which>1||g.metaKey){return true}var f={url:this.href,container:a(this).attr("data-pjax"),clickedElement:a(this)};a.pjax(a.extend({},f,e));g.preventDefault()})};a.pjax=function(f){var d=a(f.container),g=f.success||a.noop;delete f.success;if(typeof f.container!=="string"){throw"pjax container must be a string selector!"}var e={timeout:650,push:true,replace:false,data:{_pjax:true},type:"GET",dataType:"html",beforeSend:function(i){d.trigger("start.pjax");i.setRequestHeader("X-PJAX","true")},error:function(){window.location=f.url},complete:function(){d.trigger("end.pjax")},success:function(i){if(!a.trim(i)||/<html/i.test(i)){return window.location=f.url}d.html(i);var j=document.title,m=a.trim(d.find("title").remove().text());if(m){document.title=m}var l={pjax:f.container,timeout:f.timeout};var k=a.param(f.data);if(k!="_pjax=true"){l.url=f.url+(/\?/.test(f.url)?"&":"?")+k}if(f.replace){window.history.replaceState(l,document.title,f.url)}else{if(f.push){if(!a.pjax.active){window.history.replaceState(a.extend({},l,{url:null}),j);a.pjax.active=true}window.history.pushState(l,document.title,f.url)}}if((f.replace||f.push)&&window._gaq){_gaq.push(["_trackPageview"])}g.apply(this,arguments)}};f=a.extend(true,{},e,f);if(a.isFunction(f.url)){f.url=f.url()}var h=a.pjax.xhr;if(h&&h.readyState<4){h.onreadystatechange=a.noop;h.abort()}a.pjax.xhr=a.ajax(f);a(document).trigger("pjax",a.pjax.xhr,f);return a.pjax.xhr};var c=("state" in window.history),b=location.href;a(window).bind("popstate",function(e){var f=!c&&location.href==b;c=true;if(f){return}var g=e.state;if(g&&g.pjax){var d=g.pjax;if(a(d+"").length){a.pjax({url:g.url||location.href,container:d,push:false,timeout:g.timeout})}else{window.location=location.href}}});if(a.inArray("state",a.event.props)<0){a.event.props.push("state")}a.support.pjax=window.history&&window.history.pushState;if(!a.support.pjax){a.pjax=function(d){window.location=a.isFunction(d.url)?d.url():d.url};a.fn.pjax=function(){return this}}})(jQuery);