/*
 * jCarousel - Riding carousels with jQuery
 *   http://sorgalla.com/jcarousel/
 *
 * Copyright (c) 2006 Jan Sorgalla (http://sorgalla.com)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Built on top of the jQuery library
 *   http://jquery.com
 *
 * Inspired by the "Carousel Component" by Bill Scott
 *   http://billwscott.com/carousel/
 */
(function(a){var c={vertical:false,rtl:false,start:1,offset:1,size:null,scroll:3,visible:null,animation:"normal",easing:"swing",auto:0,wrap:null,initCallback:null,setupCallback:null,reloadCallback:null,itemLoadCallback:null,itemFirstInCallback:null,itemFirstOutCallback:null,itemLastInCallback:null,itemLastOutCallback:null,itemVisibleInCallback:null,itemVisibleOutCallback:null,animationStepCallback:null,buttonNextHTML:"<div></div>",buttonPrevHTML:"<div></div>",buttonNextEvent:"click",buttonPrevEvent:"click",buttonNextCallback:null,buttonPrevCallback:null,itemFallbackDimension:null},d=false;a(window).bind("load.jcarousel",function(){d=true});a.jcarousel=function(g,m){this.options=a.extend({},c,m||{});this.locked=false;this.autoStopped=false;this.container=null;this.clip=null;this.list=null;this.buttonNext=null;this.buttonPrev=null;this.buttonNextState=null;this.buttonPrevState=null;if(!m||m.rtl===undefined){this.options.rtl=(a(g).attr("dir")||a("html").attr("dir")||"").toLowerCase()=="rtl"}this.wh=!this.options.vertical?"width":"height";this.lt=!this.options.vertical?(this.options.rtl?"right":"left"):"top";var p="",q=g.className.split(" ");for(var h=0;h<q.length;h++){if(q[h].indexOf("jcarousel-skin")!=-1){a(g).removeClass(q[h]);p=q[h];break}}if(g.nodeName.toUpperCase()=="UL"||g.nodeName.toUpperCase()=="OL"){this.list=a(g);this.clip=this.list.parents(".jcarousel-clip");this.container=this.list.parents(".jcarousel-container")}else{this.container=a(g);this.list=this.container.find("ul,ol").eq(0);this.clip=this.container.find(".jcarousel-clip")}if(this.clip.size()===0){this.clip=this.list.wrap("<div></div>").parent()}if(this.container.size()===0){this.container=this.clip.wrap("<div></div>").parent()}if(p!==""&&this.container.parent()[0].className.indexOf("jcarousel-skin")==-1){this.container.wrap('<div class=" '+p+'"></div>')}this.buttonPrev=a(".jcarousel-prev",this.container);if(this.buttonPrev.size()===0&&this.options.buttonPrevHTML!==null){this.buttonPrev=a(this.options.buttonPrevHTML).appendTo(this.container)}this.buttonPrev.addClass(this.className("jcarousel-prev"));this.buttonNext=a(".jcarousel-next",this.container);if(this.buttonNext.size()===0&&this.options.buttonNextHTML!==null){this.buttonNext=a(this.options.buttonNextHTML).appendTo(this.container)}this.buttonNext.addClass(this.className("jcarousel-next"));this.clip.addClass(this.className("jcarousel-clip")).css({position:"relative"});this.list.addClass(this.className("jcarousel-list")).css({overflow:"hidden",position:"relative",top:0,margin:0,padding:0}).css((this.options.rtl?"right":"left"),0);this.container.addClass(this.className("jcarousel-container")).css({position:"relative"});if(!this.options.vertical&&this.options.rtl){this.container.addClass("jcarousel-direction-rtl").attr("dir","rtl")}var f=this.options.visible!==null?Math.ceil(this.clipping()/this.options.visible):null;var l=this.list.children("li");var n=this;if(l.size()>0){var r=0,k=this.options.offset;l.each(function(){n.format(this,k++);r+=n.dimension(this,f)});this.list.css(this.wh,(r+100)+"px");if(!m||m.size===undefined){this.options.size=l.size()}}this.container.css("display","block");this.buttonNext.css("display","block");this.buttonPrev.css("display","block");this.funcNext=function(){n.next()};this.funcPrev=function(){n.prev()};this.funcResize=function(){if(n.resizeTimer){clearTimeout(n.resizeTimer)}n.resizeTimer=setTimeout(function(){n.reload()},100)};if(this.options.initCallback!==null){this.options.initCallback(this,"init")}if(!d&&a.browser.safari){this.buttons(false,false);a(window).bind("load.jcarousel",function(){n.setup()})}else{this.setup()}};var b=a.jcarousel;b.fn=b.prototype={jcarousel:"0.2.8"};b.fn.extend=b.extend=a.extend;b.fn.extend({setup:function(){this.first=null;this.last=null;this.prevFirst=null;this.prevLast=null;this.animating=false;this.timer=null;this.resizeTimer=null;this.tail=null;this.inTail=false;if(this.locked){return}this.list.css(this.lt,this.pos(this.options.offset)+"px");var e=this.pos(this.options.start,true);this.prevFirst=this.prevLast=null;this.animate(e,false);a(window).unbind("resize.jcarousel",this.funcResize).bind("resize.jcarousel",this.funcResize);if(this.options.setupCallback!==null){this.options.setupCallback(this)}},reset:function(){this.list.empty();this.list.css(this.lt,"0px");this.list.css(this.wh,"10px");if(this.options.initCallback!==null){this.options.initCallback(this,"reset")}this.setup()},reload:function(){if(this.tail!==null&&this.inTail){this.list.css(this.lt,b.intval(this.list.css(this.lt))+this.tail)}this.tail=null;this.inTail=false;if(this.options.reloadCallback!==null){this.options.reloadCallback(this)}if(this.options.visible!==null){var g=this;var e=Math.ceil(this.clipping()/this.options.visible),h=0,f=0;this.list.children("li").each(function(j){h+=g.dimension(this,e);if(j+1<g.first){f=h}});this.list.css(this.wh,h+"px");this.list.css(this.lt,-f+"px")}this.scroll(this.first,false)},lock:function(){this.locked=true;this.buttons()},unlock:function(){this.locked=false;this.buttons()},size:function(e){if(e!==undefined){this.options.size=e;if(!this.locked){this.buttons()}}return this.options.size},has:function(g,h){if(h===undefined||!h){h=g}if(this.options.size!==null&&h>this.options.size){h=this.options.size}for(var k=g;k<=h;k++){var f=this.get(k);if(!f.length||f.hasClass("jcarousel-item-placeholder")){return false}}return true},get:function(e){return a(">.jcarousel-item-"+e,this.list)},add:function(k,p){var h=this.get(k),o=0,m=a(p);if(h.length===0){var f,l=b.intval(k);h=this.create(k);while(true){f=this.get(--l);if(l<=0||f.length){if(l<=0){this.list.prepend(h)}else{f.after(h)}break}}}else{o=this.dimension(h)}if(m.get(0).nodeName.toUpperCase()=="LI"){h.replaceWith(m);h=m}else{h.empty().append(p)}this.format(h.removeClass(this.className("jcarousel-item-placeholder")),k);var g=this.options.visible!==null?Math.ceil(this.clipping()/this.options.visible):null;var q=this.dimension(h,g)-o;if(k>0&&k<this.first){this.list.css(this.lt,b.intval(this.list.css(this.lt))-q+"px")}this.list.css(this.wh,b.intval(this.list.css(this.wh))+q+"px");return h},remove:function(h){var g=this.get(h);if(!g.length||(h>=this.first&&h<=this.last)){return}var f=this.dimension(g);if(h<this.first){this.list.css(this.lt,b.intval(this.list.css(this.lt))+f+"px")}g.remove();this.list.css(this.wh,b.intval(this.list.css(this.wh))-f+"px")},next:function(){if(this.tail!==null&&!this.inTail){this.scrollTail(false)}else{this.scroll(((this.options.wrap=="both"||this.options.wrap=="last")&&this.options.size!==null&&this.last==this.options.size)?1:this.first+this.options.scroll)}},prev:function(){if(this.tail!==null&&this.inTail){this.scrollTail(true)}else{this.scroll(((this.options.wrap=="both"||this.options.wrap=="first")&&this.options.size!==null&&this.first==1)?this.options.size:this.first-this.options.scroll)}},scrollTail:function(e){if(this.locked||this.animating||!this.tail){return}this.pauseAuto();var f=b.intval(this.list.css(this.lt));f=!e?f-this.tail:f+this.tail;this.inTail=!e;this.prevFirst=this.first;this.prevLast=this.last;this.animate(f)},scroll:function(f,e){if(this.locked||this.animating){return}this.pauseAuto();this.animate(this.pos(f),e)},pos:function(y,u){var E=b.intval(this.list.css(this.lt));if(this.locked||this.animating){return E}if(this.options.wrap!="circular"){y=y<1?1:(this.options.size&&y>this.options.size?this.options.size:y)}var h=this.first>y;var s=this.options.wrap!="circular"&&this.first<=1?1:this.first;var k=h?this.get(s):this.get(this.last);var z=h?s:s-1;var r=null,A=0,D=false,q=0,w;while(h?--z>=y:++z<y){r=this.get(z);D=!r.length;if(r.length===0){r=this.create(z).addClass(this.className("jcarousel-item-placeholder"));k[h?"before":"after"](r);if(this.first!==null&&this.options.wrap=="circular"&&this.options.size!==null&&(z<=0||z>this.options.size)){w=this.get(this.index(z));if(w.length){r=this.add(z,w.clone(true))}}}k=r;q=this.dimension(r);if(D){A+=q}if(this.first!==null&&(this.options.wrap=="circular"||(z>=1&&(this.options.size===null||z<=this.options.size)))){E=h?E+q:E-q}}var o=this.clipping(),n=[],G=0,F=0;k=this.get(y-1);z=y;while(++G){r=this.get(z);D=!r.length;if(r.length===0){r=this.create(z).addClass(this.className("jcarousel-item-placeholder"));if(k.length===0){this.list.prepend(r)}else{k[h?"before":"after"](r)}if(this.first!==null&&this.options.wrap=="circular"&&this.options.size!==null&&(z<=0||z>this.options.size)){w=this.get(this.index(z));if(w.length){r=this.add(z,w.clone(true))}}}k=r;q=this.dimension(r);if(q===0){throw new Error("jCarousel: No width/height set for items. This will cause an infinite loop. Aborting...")}if(this.options.wrap!="circular"&&this.options.size!==null&&z>this.options.size){n.push(r)}else{if(D){A+=q}}F+=q;if(F>=o){break}z++}for(var H=0;H<n.length;H++){n[H].remove()}if(A>0){this.list.css(this.wh,this.dimension(this.list)+A+"px");if(h){E-=A;this.list.css(this.lt,b.intval(this.list.css(this.lt))-A+"px")}}var B=y+G-1;if(this.options.wrap!="circular"&&this.options.size&&B>this.options.size){B=this.options.size}if(z>B){G=0;z=B;F=0;while(++G){r=this.get(z--);if(!r.length){break}F+=this.dimension(r);if(F>=o){break}}}var t=B-G+1;if(this.options.wrap!="circular"&&t<1){t=1}if(this.inTail&&h){E+=this.tail;this.inTail=false}this.tail=null;if(this.options.wrap!="circular"&&B==this.options.size&&(B-G+1)>=1){var C=b.intval(this.get(B).css(!this.options.vertical?"marginRight":"marginBottom"));if((F-C)>o){this.tail=F-o-C}}if(u&&y===this.options.size&&this.tail){E-=this.tail;this.inTail=true}while(y-->t){E+=this.dimension(this.get(y))}this.prevFirst=this.first;this.prevLast=this.last;this.first=t;this.last=B;return E},animate:function(g,e){if(this.locked||this.animating){return}this.animating=true;var i=this;var h=function(){i.animating=false;if(g===0){i.list.css(i.lt,0)}if(!i.autoStopped&&(i.options.wrap=="circular"||i.options.wrap=="both"||i.options.wrap=="last"||i.options.size===null||i.last<i.options.size||(i.last==i.options.size&&i.tail!==null&&!i.inTail))){i.startAuto()}i.buttons();i.notify("onAfterAnimation");if(i.options.wrap=="circular"&&i.options.size!==null){for(var k=i.prevFirst;k<=i.prevLast;k++){if(k!==null&&!(k>=i.first&&k<=i.last)&&(k<1||k>i.options.size)){i.remove(k)}}}};this.notify("onBeforeAnimation");if(!this.options.animation||e===false){this.list.css(this.lt,g+"px");h()}else{var f=!this.options.vertical?(this.options.rtl?{right:g}:{left:g}):{top:g};var j={duration:this.options.animation,easing:this.options.easing,complete:h};if(a.isFunction(this.options.animationStepCallback)){j.step=this.options.animationStepCallback}this.list.animate(f,j)}},startAuto:function(e){if(e!==undefined){this.options.auto=e}if(this.options.auto===0){return this.stopAuto()}if(this.timer!==null){return}this.autoStopped=false;var f=this;this.timer=window.setTimeout(function(){f.next()},this.options.auto*1000)},stopAuto:function(){this.pauseAuto();this.autoStopped=true},pauseAuto:function(){if(this.timer===null){return}window.clearTimeout(this.timer);this.timer=null},buttons:function(e,f){if(e==null){e=!this.locked&&this.options.size!==0&&((this.options.wrap&&this.options.wrap!="first")||this.options.size===null||this.last<this.options.size);if(!this.locked&&(!this.options.wrap||this.options.wrap=="first")&&this.options.size!==null&&this.last>=this.options.size){e=this.tail!==null&&!this.inTail}}if(f==null){f=!this.locked&&this.options.size!==0&&((this.options.wrap&&this.options.wrap!="last")||this.first>1);if(!this.locked&&(!this.options.wrap||this.options.wrap=="last")&&this.options.size!==null&&this.first==1){f=this.tail!==null&&this.inTail}}var g=this;if(this.buttonNext.size()>0){this.buttonNext.unbind(this.options.buttonNextEvent+".jcarousel",this.funcNext);if(e){this.buttonNext.bind(this.options.buttonNextEvent+".jcarousel",this.funcNext)}this.buttonNext[e?"removeClass":"addClass"](this.className("jcarousel-next-disabled")).attr("disabled",e?false:true);if(this.options.buttonNextCallback!==null&&this.buttonNext.data("jcarouselstate")!=e){this.buttonNext.each(function(){g.options.buttonNextCallback(g,this,e)}).data("jcarouselstate",e)}}else{if(this.options.buttonNextCallback!==null&&this.buttonNextState!=e){this.options.buttonNextCallback(g,null,e)}}if(this.buttonPrev.size()>0){this.buttonPrev.unbind(this.options.buttonPrevEvent+".jcarousel",this.funcPrev);if(f){this.buttonPrev.bind(this.options.buttonPrevEvent+".jcarousel",this.funcPrev)}this.buttonPrev[f?"removeClass":"addClass"](this.className("jcarousel-prev-disabled")).attr("disabled",f?false:true);if(this.options.buttonPrevCallback!==null&&this.buttonPrev.data("jcarouselstate")!=f){this.buttonPrev.each(function(){g.options.buttonPrevCallback(g,this,f)}).data("jcarouselstate",f)}}else{if(this.options.buttonPrevCallback!==null&&this.buttonPrevState!=f){this.options.buttonPrevCallback(g,null,f)}}this.buttonNextState=e;this.buttonPrevState=f},notify:function(e){var f=this.prevFirst===null?"init":(this.prevFirst<this.first?"next":"prev");this.callback("itemLoadCallback",e,f);if(this.prevFirst!==this.first){this.callback("itemFirstInCallback",e,f,this.first);this.callback("itemFirstOutCallback",e,f,this.prevFirst)}if(this.prevLast!==this.last){this.callback("itemLastInCallback",e,f,this.last);this.callback("itemLastOutCallback",e,f,this.prevLast)}this.callback("itemVisibleInCallback",e,f,this.first,this.last,this.prevFirst,this.prevLast);this.callback("itemVisibleOutCallback",e,f,this.prevFirst,this.prevLast,this.first,this.last)},callback:function(g,h,p,k,l,m,n){if(this.options[g]==null||(typeof this.options[g]!="object"&&h!="onAfterAnimation")){return}var f=typeof this.options[g]=="object"?this.options[g][h]:this.options[g];if(!a.isFunction(f)){return}var o=this;if(k===undefined){f(o,p,h)}else{if(l===undefined){this.get(k).each(function(){f(o,this,k,p,h)})}else{var e=function(q){o.get(q).each(function(){f(o,this,q,p,h)})};for(var j=k;j<=l;j++){if(j!==null&&!(j>=m&&j<=n)){e(j)}}}}},create:function(e){return this.format("<li></li>",e)},format:function(f,g){f=a(f);var k=f.get(0).className.split(" ");for(var h=0;h<k.length;h++){if(k[h].indexOf("jcarousel-")!=-1){f.removeClass(k[h])}}f.addClass(this.className("jcarousel-item")).addClass(this.className("jcarousel-item-"+g)).css({"float":(this.options.rtl?"right":"left"),"list-style":"none"}).attr("jcarouselindex",g);return f},className:function(e){return e+" "+e+(!this.options.vertical?"-horizontal":"-vertical")},dimension:function(g,f){var h=a(g);if(f==null){return !this.options.vertical?(h.outerWidth(true)||b.intval(this.options.itemFallbackDimension)):(h.outerHeight(true)||b.intval(this.options.itemFallbackDimension))}else{var i=!this.options.vertical?f-b.intval(h.css("marginLeft"))-b.intval(h.css("marginRight")):f-b.intval(h.css("marginTop"))-b.intval(h.css("marginBottom"));a(h).css(this.wh,i+"px");return this.dimension(h)}},clipping:function(){return !this.options.vertical?this.clip[0].offsetWidth-b.intval(this.clip.css("borderLeftWidth"))-b.intval(this.clip.css("borderRightWidth")):this.clip[0].offsetHeight-b.intval(this.clip.css("borderTopWidth"))-b.intval(this.clip.css("borderBottomWidth"))},index:function(e,f){if(f==null){f=this.options.size}return Math.round((((e-1)/f)-Math.floor((e-1)/f))*f)+1}});b.extend({defaults:function(e){return a.extend(c,e||{})},intval:function(e){e=parseInt(e,10);return isNaN(e)?0:e},windowLoaded:function(){d=true}});a.fn.jcarousel=function(g){if(typeof g=="string"){var f=a(this).data("jcarousel"),e=Array.prototype.slice.call(arguments,1);return f[g].apply(f,e)}else{return this.each(function(){var h=a(this).data("jcarousel");if(h){if(g){a.extend(h.options,g)}h.reload()}else{a(this).data("jcarousel",new b(this,g))}})}}})(jQuery);