(function(a){var u,w=this,o=w.document,b=a(o),c=a(w),n=true,t=navigator.userAgent.toLowerCase(),r=w.location.hash.replace(/#\//,""),s=(function(){var z=3,y=o.createElement("div"),x=y.getElementsByTagName("i");do{y.innerHTML="<!--[if gt IE "+(++z)+"]><i></i><![endif]-->"}while(x[0]);return z>4?z:u}()),p=function(){return{html:o.documentElement,body:o.body,head:o.getElementsByTagName("head")[0],title:o.title}},e="data ready thumbnail loadstart loadfinish image play pause progress fullscreen_enter fullscreen_exit idle_enter idle_exit rescale lightbox_open lightbox_close lightbox_image",f=(function(){var x=[];a.each(e.split(" "),function(z,y){x.push(y);if(/_/.test(y)){x.push(y.replace(/_/g,""))}});return x}()),j=function(y){var x;if(typeof y!=="object"){return y}a.each(y,function(z,A){if(/^[a-z]+_/.test(z)){x="";a.each(z.split("_"),function(B,C){x+=B>0?C.substr(0,1).toUpperCase()+C.substr(1):C});y[x]=A;delete y[z]}});return y},k=function(x){if(a.inArray(x,f)>-1){return q[x.toUpperCase()]}return x},l={trunk:{},add:function(z,y,x,A){A=A||false;this.clear(z);if(A){var B=y;y=function(){B();l.add(z,y,x)}}this.trunk[z]=w.setTimeout(y,x)},clear:function(z){var x=function(A){w.clearTimeout(this.trunk[A]);delete this.trunk[A]},y;if(!!z&&z in this.trunk){x.call(l,z)}else{if(typeof z==="undefined"){for(y in this.trunk){if(this.trunk.hasOwnProperty(y)){x.call(l,y)}}}}}},g=[],i=[],h=false,d=false,v=(function(){return{array:function(x){return Array.prototype.slice.call(x)},create:function(x,z){z=z||"div";var y=o.createElement(z);y.className=x;return y},animate:(function(){var I=(function(L){var K="transition WebkitTransition MozTransition OTransition".split(" "),J;for(J=0;K[J];J++){if(typeof L[K[J]]!=="undefined"){return K[J]}}return false}((document.body||document.documentElement).style));var C={MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[I];var B={_default:[0.25,0.1,0.25,1],galleria:[0.645,0.045,0.355,1],galleriaIn:[0.55,0.085,0.68,0.53],galleriaOut:[0.25,0.46,0.45,0.94],ease:[0.25,0,0.25,1],linear:[0.25,0.25,0.75,0.75],"ease-in":[0.42,0,1,1],"ease-out":[0,0,0.58,1],"ease-in-out":[0.42,0,0.58,1]};var F=function(K,M,L){var J={};L=L||"transition";a.each("webkit moz ms o".split(" "),function(){J["-"+this+"-"+L]=M});K.css(J)};var y=function(J){F(J,"none","transition");if(q.WEBKIT){F(J,"translate3d(0,0,0)","transform");if(J.data("revert")){J.css(J.data("revert"));J.data("revert",null)}}};var x,G,A,H,E,D,z;return function(J,L,K){K=a.extend({duration:400,complete:function(){},stop:false},K);J=a(J);if(!K.duration){J.css(L);K.complete.call(J[0]);return}if(!I){J.animate(L,K);return}if(K.stop){J.unbind(C);y(J)}x=false;a.each(L,function(M,N){z=J.css(M);if(v.parseValue(z)!=v.parseValue(N)){x=true}J.css(M,z)});if(!x){w.setTimeout(function(){K.complete.call(J[0])},K.duration);return}G=[];A=K.easing in B?B[K.easing]:B._default;H=" "+K.duration+"ms cubic-bezier("+A.join(",")+")";w.setTimeout(function(){J.one(C,(function(M){return function(){y(M);K.complete.call(M[0])}}(J)));if(q.WEBKIT&&q.TOUCH){E={};D=[0,0,0];a.each(["left","top"],function(M,N){if(N in L){D[M]=(v.parseValue(L[N])-v.parseValue(J.css(N)))+"px";E[N]=L[N];delete L[N]}});if(D[0]||D[1]){J.data("revert",E);G.push("-webkit-transform"+H);F(J,"translate3d("+D.join(",")+")","transform")}}a.each(L,function(M,N){G.push(M+H)});F(J,G.join(","));J.css(L)},1)}}()),forceStyles:function(x,y){x=a(x);if(x.attr("style")){x.data("styles",x.attr("style")).removeAttr("style")}x.css(y)},revertStyles:function(){a.each(v.array(arguments),function(y,x){x=a(x);x.removeAttr("style");x.attr("style","");if(x.data("styles")){x.attr("style",x.data("styles")).data("styles",null)}})},moveOut:function(x){v.forceStyles(x,{position:"absolute",left:-10000})},moveIn:function(){v.revertStyles.apply(v,v.array(arguments))},hide:function(y,z,x){y=a(y);if(!y.data("opacity")){y.data("opacity",y.css("opacity"))}var A={opacity:0};if(z){v.animate(y,A,{duration:z,complete:x,stop:true})}else{y.css(A)}},show:function(y,A,x){y=a(y);var z=parseFloat(y.data("opacity"))||1,B={opacity:z};if(A){v.animate(y,B,{duration:A,complete:x,stop:true})}else{y.css(B)}},optimizeTouch:(function(){var D,y,B,E,z={},C=function(F){F.preventDefault();z=a.extend({},F,true)},x=function(){this.evt=z},A=function(){this.handler.call(D,this.evt)};return function(F){a(F).bind("touchstart",function(G){D=G.target;E=true;while(D.parentNode&&D!=G.currentTarget&&E){y=a(D).data("events");B=a(D).data("fakes");if(y&&"click" in y){E=false;G.preventDefault();a(D).click(C).click();y.click.pop();a.each(y.click,x);a(D).data("fakes",y.click);delete y.click}else{if(B){E=false;G.preventDefault();a.each(B,A)}}D=D.parentNode}})}}()),addTimer:function(){l.add.apply(l,v.array(arguments));return this},clearTimer:function(){l.clear.apply(l,v.array(arguments));return this},wait:function(A){A=a.extend({until:function(){return false},success:function(){},error:function(){q.raise("Could not complete wait function.")},timeout:3000},A);var B=v.timestamp(),x,z,y=function(){z=v.timestamp();x=z-B;if(A.until(x)){A.success();return false}if(z>=B+A.timeout){A.error();return false}w.setTimeout(y,2)};w.setTimeout(y,2)},toggleQuality:function(y,x){if((s!==7&&s!==8)||!y){return}if(typeof x==="undefined"){x=y.style.msInterpolationMode==="nearest-neighbor"}y.style.msInterpolationMode=x?"bicubic":"nearest-neighbor"},insertStyleTag:function(z){var y=o.createElement("style");p().head.appendChild(y);if(y.styleSheet){y.styleSheet.cssText=z}else{var x=o.createTextNode(z);y.appendChild(x)}},loadScript:function(A,x){var y=false,z=a("<script>").attr({src:A,async:true}).get(0);z.onload=z.onreadystatechange=function(){if(!y&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){y=true;z.onload=z.onreadystatechange=null;if(typeof x==="function"){x.call(this,this)}}};p().head.appendChild(z)},parseValue:function(y){if(typeof y==="number"){return y}else{if(typeof y==="string"){var x=y.match(/\-?\d|\./g);return x&&x.constructor===Array?x.join("")*1:0}else{return 0}}},timestamp:function(){return new Date().getTime()},loadCSS:function(y,z,x){var B,C=false,A;a("link[rel=stylesheet]").each(function(){if(new RegExp(y).test(this.href)){B=this;return false}});if(typeof z==="function"){x=z;z=u}x=x||function(){};if(B){x.call(B,B);return B}A=o.styleSheets.length;if(n){y+="?"+v.timestamp()}if(a("#"+z).length){a("#"+z).attr("href",y);A--;C=true}else{B=a("<link>").attr({rel:"stylesheet",href:y,id:z}).get(0);w.setTimeout(function(){var D=a('link[rel="stylesheet"], style');if(D.length){D.get(0).parentNode.insertBefore(B,D[0])}else{p().head.appendChild(B)}if(s){if(A>=31){q.raise("You have reached the browser stylesheet limit (31)",true);return}B.onreadystatechange=function(E){if(!C&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){C=true}}}else{if(!(new RegExp("file://","i").test(y))){a.ajax({url:y,success:function(){C=true},error:function(E){if(E.isRejected()&&q.WEBKIT){C=true}}})}else{C=true}}},10)}if(typeof x==="function"){v.wait({until:function(){return C&&o.styleSheets.length>A},success:function(){w.setTimeout(function(){x.call(B,B)},100)},error:function(){q.raise("Theme CSS could not load",true)},timeout:10000})}return B}}}()),m=(function(){var x=function(E,y,C,A){var B=this.getOptions("easing"),z=this.getStageWidth(),D={left:z*(E.rewind?-1:1)},F={left:0};if(C){D.opacity=0;F.opacity=1}a(E.next).css(D);v.animate(E.next,F,{duration:E.speed,complete:(function(G){return function(){y();G.css({left:0})}}(a(E.next).add(E.prev))),queue:false,easing:B});if(A){E.rewind=!E.rewind}if(E.prev){D={left:0};F={left:z*(E.rewind?1:-1)};if(C){D.opacity=1;F.opacity=0}a(E.prev).css(D);v.animate(E.prev,F,{duration:E.speed,queue:false,easing:B,complete:function(){a(this).css("opacity",0)}})}};return{fade:function(z,y){a(z.next).css("opacity",0).show();v.animate(z.next,{opacity:1},{duration:z.speed,complete:y});if(z.prev){a(z.prev).css("opacity",1).show();v.animate(z.prev,{opacity:0},{duration:z.speed})}},flash:function(z,y){a(z.next).css("opacity",0);if(z.prev){v.animate(z.prev,{opacity:0},{duration:z.speed/2,complete:function(){v.animate(z.next,{opacity:1},{duration:z.speed,complete:y})}})}else{v.animate(z.next,{opacity:1},{duration:z.speed,complete:y})}},pulse:function(z,y){if(z.prev){a(z.prev).hide()}a(z.next).css("opacity",0).show();v.animate(z.next,{opacity:1},{duration:z.speed,complete:y})},slide:function(z,y){x.apply(this,v.array(arguments))},fadeslide:function(z,y){x.apply(this,v.array(arguments).concat([true]))},doorslide:function(z,y){x.apply(this,v.array(arguments).concat([false,true]))}}})();var q=function(){var E=this;this._theme=u;this._options={};this._playing=false;this._playtime=5000;this._active=null;this._queue={length:0};this._data=[];this._dom={};this._thumbnails=[];this._initialized=false;this._firstrun=false;this._stageWidth=0;this._stageHeight=0;this._target=u;this._id=Math.random();var z="container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter tooltip",F="current total";a.each(z.split(" "),function(I,H){E._dom[H]=v.create("galleria-"+H)});a.each(F.split(" "),function(I,H){E._dom[H]=v.create("galleria-"+H,"span")});var C=this._keyboard={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:false,press:function(H){var I=H.keyCode||H.which;if(I in C.map&&typeof C.map[I]==="function"){C.map[I].call(E,H)}},attach:function(I){var H,J;for(H in I){if(I.hasOwnProperty(H)){J=H.toUpperCase();if(J in C.keys){C.map[C.keys[J]]=I[H]}else{C.map[J]=I[H]}}}if(!C.bound){C.bound=true;b.bind("keydown",C.press)}},detach:function(){C.bound=false;C.map={};b.unbind("keydown",C.press)}};var y=this._controls={0:u,1:u,active:0,swap:function(){y.active=y.active?0:1},getActive:function(){return y[y.active]},getNext:function(){return y[1-y.active]}};var x=this._carousel={next:E.$("thumb-nav-right"),prev:E.$("thumb-nav-left"),width:0,current:0,max:0,hooks:[],update:function(){var J=0,H=0,I=[0];a.each(E._thumbnails,function(K,L){if(L.ready){J+=L.outerWidth||a(L.container).outerWidth(true);I[K+1]=J;H=Math.max(H,L.outerHeight||a(L.container).outerHeight(true))}});E.$("thumbnails").css({width:J,height:H});x.max=J;x.hooks=I;x.width=E.$("thumbnails-list").width();x.setClasses();E.$("thumbnails-container").toggleClass("galleria-carousel",J>x.width);x.width=E.$("thumbnails-list").width()},bindControls:function(){var H;x.next.bind("click",function(I){I.preventDefault();if(E._options.carouselSteps==="auto"){for(H=x.current;H<x.hooks.length;H++){if(x.hooks[H]-x.hooks[x.current]>x.width){x.set(H-2);break}}}else{x.set(x.current+E._options.carouselSteps)}});x.prev.bind("click",function(I){I.preventDefault();if(E._options.carouselSteps==="auto"){for(H=x.current;H>=0;H--){if(x.hooks[x.current]-x.hooks[H]>x.width){x.set(H+2);break}else{if(H===0){x.set(0);break}}}}else{x.set(x.current-E._options.carouselSteps)}})},set:function(H){H=Math.max(H,0);while(x.hooks[H-1]+x.width>=x.max&&H>=0){H--}x.current=H;x.animate()},getLast:function(H){return(H||x.current)-1},follow:function(H){if(H===0||H===x.hooks.length-2){x.set(H);return}var I=x.current;while(x.hooks[I]-x.hooks[x.current]<x.width&&I<=x.hooks.length){I++}if(H-1<x.current){x.set(H-1)}else{if(H+2>I){x.set(H-I+x.current+2)}}},setClasses:function(){x.prev.toggleClass("disabled",!x.current);x.next.toggleClass("disabled",x.hooks[x.current]+x.width>=x.max)},animate:function(I){x.setClasses();var H=x.hooks[x.current]*-1;if(isNaN(H)){return}v.animate(E.get("thumbnails"),{left:H},{duration:E._options.carouselSpeed,easing:E._options.easing,queue:false})}};var G=this._tooltip={initialized:false,open:false,init:function(){G.initialized=true;var H=".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}";v.insertStyleTag(H);E.$("tooltip").css("opacity",0.8);v.hide(E.get("tooltip"))},move:function(I){var N=E.getMousePosition(I).x,O=E.getMousePosition(I).y,H=E.$("tooltip"),Q=N,R=O,J=H.outerHeight(true)+1,P=H.outerWidth(true),K=J+15;var L=E.$("container").width()-P-2,M=E.$("container").height()-J-2;if(!isNaN(Q)&&!isNaN(R)){Q+=10;R-=30;Q=Math.max(0,Math.min(L,Q));R=Math.max(0,Math.min(M,R));if(O<K){R=K}H.css({left:Q,top:R})}},bind:function(H,J){if(q.TOUCH){return}if(!G.initialized){G.init()}var I=function(K,L){G.define(K,L);a(K).hover(function(){v.clearTimer("switch_tooltip");E.$("container").unbind("mousemove",G.move).bind("mousemove",G.move).trigger("mousemove");G.show(K);q.utils.addTimer("tooltip",function(){E.$("tooltip").stop().show().animate({opacity:1});G.open=true},G.open?0:500)},function(){E.$("container").unbind("mousemove",G.move);v.clearTimer("tooltip");E.$("tooltip").stop().animate({opacity:0},200,function(){E.$("tooltip").hide();v.addTimer("switch_tooltip",function(){G.open=false},1000)})})};if(typeof J==="string"){I((H in E._dom?E.get(H):H),J)}else{a.each(H,function(K,L){I(E.get(K),L)})}},show:function(H){H=a(H in E._dom?E.get(H):H);var J=H.data("tt"),I=function(K){w.setTimeout((function(L){return function(){G.move(L)}}(K)),10);H.unbind("mouseup",I)};J=typeof J==="function"?J():J;if(!J){return}E.$("tooltip").html(J.replace(/\s/,"&nbsp;"));H.bind("mouseup",I)},define:function(H,J){if(typeof J!=="function"){var I=J;J=function(){return I}}H=a(H in E._dom?E.get(H):H).data("tt",J);G.show(H)}};var A=this._fullscreen={scrolled:0,active:false,keymap:E._keyboard.map,enter:function(J){A.active=true;v.hide(E.getActiveImage());E.$("container").addClass("fullscreen");A.scrolled=c.scrollTop();v.forceStyles(E.get("container"),{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:10000});var L={height:"100%",overflow:"hidden",margin:0,padding:0},K=E.getData();v.forceStyles(p().html,L);v.forceStyles(p().body,L);A.keymap=a.extend({},E._keyboard.map);E.attachKeyboard({escape:E.exitFullscreen,right:E.next,left:E.prev});if(K&&K.big&&K.image!==K.big){var H=new q.Picture(),I=H.isCached(K.big),M=E.getIndex(),N=E._thumbnails[M];E.trigger({type:q.LOADSTART,cached:I,index:M,imageTarget:E.getActiveImage(),thumbTarget:N});H.load(K.big,function(O){E._scaleImage(O,{complete:function(P){E.trigger({type:q.LOADFINISH,cached:I,index:M,imageTarget:P.image,thumbTarget:N});var Q=E._controls.getActive().image;if(Q){a(Q).width(P.image.width).height(P.image.height).attr("style",a(P.image).attr("style")).attr("src",P.image.src)}}})})}E.rescale(function(){v.addTimer("fullscreen_enter",function(){v.show(E.getActiveImage());if(typeof J==="function"){J.call(E)}},100);E.trigger(q.FULLSCREEN_ENTER)});c.resize(function(){A.scale()})},scale:function(){E.rescale()},exit:function(H){A.active=false;v.hide(E.getActiveImage());E.$("container").removeClass("fullscreen");v.revertStyles(E.get("container"),p().html,p().body);w.scrollTo(0,A.scrolled);E.detachKeyboard();E.attachKeyboard(A.keymap);E.rescale(function(){v.addTimer("fullscreen_exit",function(){v.show(E.getActiveImage());if(typeof H==="function"){H.call(E)}},50);E.trigger(q.FULLSCREEN_EXIT)});c.unbind("resize",A.scale)}};var B=this._idle={trunk:[],bound:false,add:function(H,K){if(!H){return}if(!B.bound){B.addEvent()}H=a(H);var I={},J;for(J in K){if(K.hasOwnProperty(J)){I[J]=H.css(J)}}H.data("idle",{from:I,to:K,complete:true,busy:false});B.addTimer();B.trunk.push(H)},remove:function(H){H=jQuery(H);a.each(B.trunk,function(J,I){if(I.length&&!I.not(H).length){E._idle.show(H);E._idle.trunk.splice(J,1)}});if(!B.trunk.length){B.removeEvent();v.clearTimer("idle")}},addEvent:function(){B.bound=true;E.$("container").bind("mousemove click",B.showAll)},removeEvent:function(){B.bound=false;E.$("container").unbind("mousemove click",B.showAll)},addTimer:function(){v.addTimer("idle",function(){E._idle.hide()},E._options.idleTime)},hide:function(){if(!E._options.idleMode){return}E.trigger(q.IDLE_ENTER);a.each(B.trunk,function(J,I){var H=I.data("idle");if(!H){return}I.data("idle").complete=false;v.animate(I,H.to,{duration:E._options.idleSpeed})})},showAll:function(){v.clearTimer("idle");a.each(E._idle.trunk,function(I,H){E._idle.show(H)})},show:function(I){var H=I.data("idle");if(!H.busy&&!H.complete){H.busy=true;E.trigger(q.IDLE_EXIT);v.clearTimer("idle");v.animate(I,H.from,{duration:E._options.idleSpeed/2,complete:function(){a(this).data("idle").busy=false;a(this).data("idle").complete=true}})}B.addTimer()}};var D=this._lightbox={width:0,height:0,initialized:false,active:null,image:null,elems:{},keymap:false,init:function(){E.trigger(q.LIGHTBOX_OPEN);if(D.initialized){return}D.initialized=true;var M="overlay box content shadow title info close prevholder prev nextholder next counter image",L={},O=E._options,J="",H="position:absolute;",P="lightbox-",K={overlay:"position:fixed;display:none;opacity:"+O.overlayOpacity+";filter:alpha(opacity="+(O.overlayOpacity*100)+");top:0;left:0;width:100%;height:100%;background:"+O.overlayBackground+";z-index:99990",box:"position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",shadow:H+"background:#000;width:100%;height:100%;",content:H+"background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",info:H+"bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",close:H+"top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",image:H+"top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",prevholder:H+"width:50%;top:0;bottom:40px;cursor:pointer;",nextholder:H+"width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",prev:H+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",next:H+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",title:"float:left",counter:"float:right;margin-left:8px;"},N=function(Q){return Q.hover(function(){a(this).css("color","#bbb")},function(){a(this).css("color","#444")})},I={};if(s===8){K.nextholder+="background:#000;filter:alpha(opacity=0);";K.prevholder+="background:#000;filter:alpha(opacity=0);"}a.each(K,function(Q,R){J+=".galleria-"+P+Q+"{"+R+"}"});v.insertStyleTag(J);a.each(M.split(" "),function(R,Q){E.addElement("lightbox-"+Q);L[Q]=D.elems[Q]=E.get("lightbox-"+Q)});D.image=new q.Picture();a.each({box:"shadow content close prevholder nextholder",info:"title counter",content:"info image",prevholder:"prev",nextholder:"next"},function(R,S){var Q=[];a.each(S.split(" "),function(T,U){Q.push(P+U)});I[P+R]=Q});E.append(I);a(L.image).append(D.image.container);a(p().body).append(L.overlay,L.box);v.optimizeTouch(L.box);N(a(L.close).bind("click",D.hide).html("&#215;"));a.each(["Prev","Next"],function(T,S){var Q=a(L[S.toLowerCase()]).html(/v/.test(S)?"&#8249;&nbsp;":"&nbsp;&#8250;"),R=a(L[S.toLowerCase()+"holder"]);R.bind("click",function(){D["show"+S]()});if(s<8||q.TOUCH){Q.show();return}R.hover(function(){Q.show()},function(U){Q.stop().fadeOut(200)})});a(L.overlay).bind("click",D.hide);if(q.IPAD){E._options.lightboxTransitionSpeed=0}},rescale:function(J){var N=Math.min(c.width()-40,D.width),K=Math.min(c.height()-60,D.height),L=Math.min(N/D.width,K/D.height),I=Math.round(D.width*L)+40,H=Math.round(D.height*L)+60,M={width:I,height:H,"margin-top":Math.ceil(H/2)*-1,"margin-left":Math.ceil(I/2)*-1};if(J){a(D.elems.box).css(M)}else{a(D.elems.box).animate(M,{duration:E._options.lightboxTransitionSpeed,easing:E._options.easing,complete:function(){var O=D.image,P=E._options.lightboxFadeSpeed;E.trigger({type:q.LIGHTBOX_IMAGE,imageTarget:O.image});a(O.container).show();v.show(O.image,P);v.show(D.elems.info,P)}})}},hide:function(){D.image.image=null;c.unbind("resize",D.rescale);a(D.elems.box).hide();v.hide(D.elems.info);E.detachKeyboard();E.attachKeyboard(D.keymap);D.keymap=false;v.hide(D.elems.overlay,200,function(){a(this).hide().css("opacity",E._options.overlayOpacity);E.trigger(q.LIGHTBOX_CLOSE)})},showNext:function(){D.show(E.getNext(D.active))},showPrev:function(){D.show(E.getPrev(D.active))},show:function(I){D.active=I=typeof I==="number"?I:E.getIndex();if(!D.initialized){D.init()}if(!D.keymap){D.keymap=a.extend({},E._keyboard.map);E.attachKeyboard({escape:D.hide,right:D.showNext,left:D.showPrev})}c.unbind("resize",D.rescale);var H=E.getData(I),J=E.getDataLength();v.hide(D.elems.info);D.image.load(H.big||H.image,function(K){D.width=K.original.width;D.height=K.original.height;a(K.image).css({width:"100.5%",height:"100.5%",top:0,zIndex:99998});v.hide(K.image);D.elems.title.innerHTML=H.title||"";D.elems.counter.innerHTML=(I+1)+" / "+J;c.resize(D.rescale);D.rescale()});a(D.elems.overlay).show();a(D.elems.box).show()}};return this};q.prototype={constructor:q,init:function(z,x){var y=this;x=j(x);this._original={target:z,options:x,data:null};this._target=this._dom.target=z.nodeName?z:a(z).get(0);i.push(this);if(!this._target){q.raise("Target not found.",true);return}this._options={autoplay:false,carousel:true,carouselFollow:true,carouselSpeed:400,carouselSteps:"auto",clicknext:false,dataConfig:function(A){return{}},dataSelector:"img",dataSource:this._target,debug:u,easing:"galleria",extend:function(A){},fullscreenDoubleTap:true,height:"auto",idleMode:true,idleTime:3000,idleSpeed:200,imageCrop:false,imageMargin:0,imagePan:false,imagePanSmoothness:12,imagePosition:"50%",initialTransition:u,keepSource:false,lightbox:false,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceTmages:true,maxScaleRatio:u,minScaleRatio:u,overlayOpacity:0.85,overlayBackground:"#0b0b0b",pauseOnInteraction:true,popupLinks:false,preload:2,protect:false,queue:true,show:0,showInfo:true,showCounter:true,showImagenav:true,swipe:true,thumbCrop:true,thumbEventType:"click",thumbFit:true,thumbMargin:0,thumbQuality:"auto",thumbnails:true,transition:"fade",transitionInitial:u,transitionSpeed:400,useCanvas:false,width:"auto"};this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial;if(x&&x.debug===false){n=false}a(this._target).children().hide();if(typeof q.theme==="object"){this._init()}else{v.wait({until:function(){return typeof q.theme==="object"},success:function(){y._init.call(y)},error:function(){q.raise("No theme found.",true)},timeout:5000})}},_init:function(){var x=this;if(this._initialized){q.raise("Init failed: Gallery instance already initialized.");return this}this._initialized=true;if(!q.theme){q.raise("Init failed: No theme found.");return this}a.extend(true,this._options,q.theme.defaults,this._original.options);(function(y){if(!("getContext" in y)){y=null;return}d=d||{elem:y,context:y.getContext("2d"),cache:{},length:0}}(o.createElement("canvas")));this.bind(q.DATA,function(){this._original.data=this._data;this.get("total").innerHTML=this.getDataLength();var y=this.$("container");var z={width:0,height:0};var A=function(){return x.$("stage").height()};v.wait({until:function(){a.each(["width","height"],function(B,C){if(x._options[C]&&typeof x._options[C]==="number"){z[C]=x._options[C]}else{z[C]=Math.max(v.parseValue(y.css(C)),v.parseValue(x.$("target").css(C)),y[C](),x.$("target")[C]())}y[C](z[C])});return A()&&z.width&&z.height>10},success:function(){if(q.WEBKIT){w.setTimeout(function(){x._run()},1)}else{x._run()}},error:function(){if(A()){q.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:"+z.width+"px, height: "+z.height+"px.",true)}else{q.raise("Could not extract a stage height from the CSS. Traced height: "+A()+"px.",true)}},timeout:2000})});this.append({"info-text":["info-title","info-description"],info:["info-text"],"image-nav":["image-nav-right","image-nav-left"],stage:["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],container:["stage","thumbnails-container","info","tooltip"]});v.hide(this.$("counter").append(this.get("current")," / ",this.get("total")));this.setCounter("&#8211;");v.hide(x.get("tooltip"));this.$("container").addClass(q.TOUCH?"touch":"notouch");a.each(new Array(2),function(y){var z=new q.Picture();a(z.container).css({position:"absolute",top:0,left:0});x.$("images").append(z.container);x._controls[y]=z});this.$("images").css({position:"relative",top:0,left:0,width:"100%",height:"100%"});this.$("thumbnails, thumbnails-list").css({overflow:"hidden",position:"relative"});this.$("image-nav-right, image-nav-left").bind("click",function(y){if(x._options.clicknext){y.stopPropagation()}if(x._options.pauseOnInteraction){x.pause()}var z=/right/.test(this.className)?"next":"prev";x[z]()});a.each(["info","counter","image-nav"],function(z,y){if(x._options["show"+y.substr(0,1).toUpperCase()+y.substr(1).replace(/-/,"")]===false){v.moveOut(x.get(y.toLowerCase()))}});this.load();if(!this._options.keep_source&&!s){this._target.innerHTML=""}this.$("target").append(this.get("container"));if(this._options.carousel){this.bind(q.THUMBNAIL,function(){this.updateCarousel()})}if(this._options.swipe){(function(B){var G=[0,0],H=[0,0],C=30,D=100,F=false,I=0,y,z={start:"touchstart",move:"touchmove",stop:"touchend"},A=function(K){return K.originalEvent.touches?K.originalEvent.touches[0]:K},E=function(K){if(K.originalEvent.touches&&K.originalEvent.touches.length>1){return}y=A(K);H=[y.pageX,y.pageY];if(!G[0]){G=H}if(Math.abs(G[0]-H[0])>10){K.preventDefault()}},J=function(K){B.unbind(z.move,E);if((K.originalEvent.touches&&K.originalEvent.touches.length)||F){F=!F;return}if(v.timestamp()-I<1000&&Math.abs(G[0]-H[0])>C&&Math.abs(G[1]-H[1])<D){K.preventDefault();x[G[0]>H[0]?"next":"prev"]()}G=H=[0,0]};B.bind(z.start,function(K){if(K.originalEvent.touches&&K.originalEvent.touches.length>1){return}y=A(K);I=v.timestamp();G=H=[y.pageX,y.pageY];B.bind(z.move,E).one(z.stop,J)})}(x.$("images")));if(this._options.fullscreenDoubleTap){this.$("stage").bind("touchstart",(function(){var B,y,z,C,D,E,A=function(F){return F.originalEvent.touches?F.originalEvent.touches[0]:F};return function(F){E=q.utils.timestamp();y=A(F).pageX;z=A(F).pageY;if((E-B<500)&&(y-C<20)&&(z-D<20)){x.toggleFullscreen();F.preventDefault();x.$("stage").unbind("touchend",arguments.callee);return}B=E;C=y;D=z}}()))}}v.optimizeTouch(this.get("container"));return this},_createThumbnails:function(){this.get("total").innerHTML=this.getDataLength();var C,I,J,z,x,H=this,D=this._options,y=(function(){var K=H.$("thumbnails").find(".active");if(!K.length){return false}return K.find("img").attr("src")}()),G=typeof D.thumbnails==="string"?D.thumbnails.toLowerCase():null,B=function(K){return o.defaultView&&o.defaultView.getComputedStyle?o.defaultView.getComputedStyle(J.container,null)[K]:x.css(K)},A=function(L,M,K){return function(){a(K).append(L);H.trigger({type:q.THUMBNAIL,thumbTarget:L,index:M})}},E=function(K){if(D.pauseOnInteraction){H.pause()}var L=a(K.currentTarget).data("index");if(H.getIndex()!==L){H.show(L)}K.preventDefault()},F=function(K){K.scale({width:K.data.width,height:K.data.height,crop:D.thumbCrop,margin:D.thumbMargin,canvas:D.useCanvas,complete:function(O){var P=["left","top"],L=["Width","Height"],N,M;a.each(L,function(Q,R){N=R.toLowerCase();if((D.thumbCrop!==true||D.thumbCrop===N)&&D.thumbFit){M={};M[N]=O[N];a(O.container).css(M);M={};M[P[Q]]=0;a(O.image).css(M)}O["outer"+R]=a(O.container)["outer"+R](true)});v.toggleQuality(O.image,D.thumbQuality===true||(D.thumbQuality==="auto"&&O.original.width<O.width*3));H.trigger({type:q.THUMBNAIL,thumbTarget:O.image,index:O.data.order})}})};this._thumbnails=[];this.$("thumbnails").empty();for(C=0;this._data[C];C++){z=this._data[C];if(D.thumbnails===true){J=new q.Picture(C);I=z.thumb||z.image;this.$("thumbnails").append(J.container);x=a(J.container);J.data={width:v.parseValue(B("width")),height:v.parseValue(B("height")),order:C};if(D.thumbFit&&D.thumbCrop!==true){x.css({width:0,height:0})}else{x.css({width:J.data.width,height:J.data.height})}J.load(I,F);if(D.preload==="all"){J.add(z.image)}}else{if(G==="empty"||G==="numbers"){J={container:v.create("galleria-image"),image:v.create("img","span"),ready:true};if(G==="numbers"){a(J.image).text(C+1)}this.$("thumbnails").append(J.container);w.setTimeout((A)(J.image,C,J.container),50+(C*20))}else{J={container:null,image:null}}}a(J.container).add(D.keepSource&&D.linkSourceImages?z.original:null).data("index",C).bind(D.thumbEventType,E);if(y===I){a(J.container).addClass("active")}this._thumbnails.push(J)}},_run:function(){var x=this;x._createThumbnails();v.wait({until:function(){if(q.OPERA){x.$("stage").css("display","inline-block")}x._stageWidth=x.$("stage").width();x._stageHeight=x.$("stage").height();return(x._stageWidth&&x._stageHeight>50)},success:function(){g.push(x);v.show(x.get("counter"));if(x._options.carousel){x._carousel.bindControls()}if(x._options.autoplay){x.pause();if(typeof x._options.autoplay==="number"){x._playtime=x._options.autoplay}x.trigger(q.PLAY);x._playing=true}if(x._firstrun){if(typeof x._options.show==="number"){x.show(x._options.show)}return}x._firstrun=true;if(x._options.clicknext&&!q.TOUCH){a.each(x._data,function(z,y){delete y.link});x.$("stage").css({cursor:"pointer"}).bind("click",function(y){if(x._options.pauseOnInteraction){x.pause()}x.next()})}if(q.History){q.History.change(function(y){var z=parseInt(y.value.replace(/\//,""),10);if(isNaN(z)){w.history.go(-1)}else{x.show(z,u,true)}})}a.each(q.ready.callbacks,function(){this.call(x,x._options)});x.trigger(q.READY);q.theme.init.call(x,x._options);x._options.extend.call(x,x._options);if(/^[0-9]{1,4}$/.test(r)&&q.History){x.show(r,u,true)}else{if(x._data[x._options.show]){x.show(x._options.show)}}},error:function(){q.raise("Stage width or height is too small to show the gallery. Traced measures: width:"+x._stageWidth+"px, height: "+x._stageHeight+"px.",true)}})},load:function(A,y,x){var z=this;this._data=[];this._thumbnails=[];this.$("thumbnails").empty();if(typeof y==="function"){x=y;y=null}A=A||this._options.dataSource;y=y||this._options.dataSelector;x=x||this._options.dataConfig;if(/^function Object/.test(A.constructor)){A=[A]}if(A.constructor===Array){if(this.validate(A)){this._data=A;this._parseData().trigger(q.DATA)}else{q.raise("Load failed: JSON Array not valid.")}return this}a(A).find(y).each(function(D,E){E=a(E);var B={},F=E.parent(),C=F.attr("href"),H=F.attr("rel"),G=/\.(png|gif|jpg|jpeg)(\?.*)?$/i;if(G.test(C)){B.image=C;if(G.test(H)){B.big=H}else{B.big=C}}else{if(C){B.link=C}}z._data.push(a.extend({title:E.attr("title")||"",thumb:E.attr("src"),image:E.attr("src"),big:E.attr("src"),description:E.attr("alt")||"",link:E.attr("longdesc"),original:E.get(0)},B,x(E)))});if(this.getDataLength()){this.trigger(q.DATA)}else{q.raise("Load failed: no data found.")}return this},_parseData:function(){var x=this;a.each(this._data,function(z,y){if("thumb" in y===false){x._data[z].thumb=y.image}if(!"big" in y){x._data[z].big=y.image}});return this},splice:function(){Array.prototype.splice.apply(this._data,v.array(arguments));return this._parseData()._createThumbnails()},push:function(){Array.prototype.push.apply(this._data,v.array(arguments));return this._parseData()._createThumbnails()},_getActive:function(){return this._controls.getActive()},validate:function(x){return true},bind:function(y,x){y=k(y);this.$("container").bind(y,this.proxy(x));return this},unbind:function(x){x=k(x);this.$("container").unbind(x);return this},trigger:function(x){x=typeof x==="object"?a.extend(x,{scope:this}):{type:k(x),scope:this};this.$("container").trigger(x);return this},addIdleState:function(x,y){this._idle.add.apply(this._idle,v.array(arguments));return this},removeIdleState:function(x){this._idle.remove.apply(this._idle,v.array(arguments));return this},enterIdleMode:function(){this._idle.hide();return this},exitIdleMode:function(){this._idle.showAll();return this},enterFullscreen:function(x){this._fullscreen.enter.apply(this,v.array(arguments));return this},exitFullscreen:function(x){this._fullscreen.exit.apply(this,v.array(arguments));return this},toggleFullscreen:function(x){this._fullscreen[this.isFullscreen()?"exit":"enter"].apply(this,v.array(arguments));return this},bindTooltip:function(x,y){this._tooltip.bind.apply(this._tooltip,v.array(arguments));return this},defineTooltip:function(x,y){this._tooltip.define.apply(this._tooltip,v.array(arguments));return this},refreshTooltip:function(x){this._tooltip.show.apply(this._tooltip,v.array(arguments));return this},openLightbox:function(){this._lightbox.show.apply(this._lightbox,v.array(arguments));return this},closeLightbox:function(){this._lightbox.hide.apply(this._lightbox,v.array(arguments));return this},getActiveImage:function(){return this._getActive().image||u},getActiveThumb:function(){return this._thumbnails[this._active].image||u},getMousePosition:function(x){return{x:x.pageX-this.$("container").offset().left,y:x.pageY-this.$("container").offset().top}},addPan:function(I){if(this._options.imageCrop===false){return}I=a(I||this.getActiveImage());var M=this,O=I.width()/2,P=I.height()/2,E=parseInt(I.css("left"),10),F=parseInt(I.css("top"),10),C=E||0,D=F||0,G=0,H=0,z=false,N=v.timestamp(),A=0,K=0,L=function(Q,y,R){if(Q>0){K=Math.round(Math.max(Q*-1,Math.min(0,y)));if(A!==K){A=K;if(s===8){I.parent()["scroll"+R](K*-1)}else{var x={};x[R.toLowerCase()]=K;I.css(x)}}}},B=function(x){if(v.timestamp()-N<50){return}z=true;O=M.getMousePosition(x).x;P=M.getMousePosition(x).y},J=function(x){if(!z){return}G=I.width()-M._stageWidth;H=I.height()-M._stageHeight;E=O/M._stageWidth*G*-1;F=P/M._stageHeight*H*-1;C+=(E-C)/M._options.imagePanSmoothness;D+=(F-D)/M._options.imagePanSmoothness;L(H,D,"Top");L(G,C,"Left")};if(s===8){I.parent().scrollTop(D*-1).scrollLeft(C*-1);I.css({top:0,left:0})}this.$("stage").unbind("mousemove",B).bind("mousemove",B);v.addTimer("pan",J,50,true);return this},proxy:function(x,y){if(typeof x!=="function"){return function(){}}y=y||this;return function(){return x.apply(y,v.array(arguments))}},removePan:function(){this.$("stage").unbind("mousemove");v.clearTimer("pan");return this},addElement:function(y){var x=this._dom;a.each(v.array(arguments),function(A,z){x[z]=v.create("galleria-"+z)});return this},attachKeyboard:function(x){this._keyboard.attach.apply(this._keyboard,v.array(arguments));return this},detachKeyboard:function(){this._keyboard.detach.apply(this._keyboard,v.array(arguments));return this},appendChild:function(y,x){this.$(y).append(this.get(x)||x);return this},prependChild:function(y,x){this.$(y).prepend(this.get(x)||x);return this},remove:function(x){this.$(v.array(arguments).join(",")).remove();return this},append:function(x){var y,z;for(y in x){if(x.hasOwnProperty(y)){if(x[y].constructor===Array){for(z=0;x[y][z];z++){this.appendChild(y,x[y][z])}}else{this.appendChild(y,x[y])}}}return this},_scaleImage:function(x,y){y=a.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition},y);(x||this._controls.getActive()).scale(y);return this},updateCarousel:function(){this._carousel.update();return this},rescale:function(B,y,x){var A=this;if(typeof B==="function"){x=B;B=u}var z=function(){A._stageWidth=B||A.$("stage").width();A._stageHeight=y||A.$("stage").height();A._scaleImage();if(A._options.carousel){A.updateCarousel()}A.trigger(q.RESCALE);if(typeof x==="function"){x.call(A)}};if(q.WEBKIT&&!B&&!y){v.addTimer("scale",z,10)}else{z.call(A)}return this},refreshImage:function(){this._scaleImage();if(this._options.imagePan){this.addPan()}return this},show:function(y,z,x){if(y===false||(!this._options.queue&&this._queue.stalled)){return}y=Math.max(0,Math.min(parseInt(y,10),this.getDataLength()-1));z=typeof z!=="undefined"?!!z:y<this.getIndex();x=x||false;if(!x&&q.History){q.History.value(y.toString());return}this._active=y;Array.prototype.push.call(this._queue,{index:y,rewind:z});if(!this._queue.stalled){this._show()}return this},_show:function(){var I=this,H=this._queue[0],A=this.getData(H.index);if(!A){return}var J=this.isFullscreen()&&"big" in A?A.big:A.image,x=this._controls.getActive(),F=this._controls.getNext(),y=F.isCached(J),K=this._thumbnails[H.index];var z=(function(M,N,L,O,P){return function(){var Q;I._queue.stalled=false;v.toggleQuality(N.image,I._options.imageQuality);a(L.container).css({zIndex:0,opacity:0}).show();a(N.container).css({zIndex:1,opacity:1}).show();I._controls.swap();if(I._options.imagePan){I.addPan(N.image)}if(M.link||I._options.lightbox){a(N.image).css({cursor:"pointer"}).bind("mouseup",function(){if(M.link){if(I._options.popupLinks){Q=w.open(M.link,"_blank")}else{w.location.href=M.link}return}I.openLightbox()})}Array.prototype.shift.call(I._queue);if(I._queue.length){I._show()}I._playCheck();I.trigger({type:q.IMAGE,index:O.index,imageTarget:N.image,thumbTarget:P.image})}}(A,F,x,H,K));if(this._options.carousel&&this._options.carouselFollow){this._carousel.follow(H.index)}if(this._options.preload){var G,C,D=this.getNext(),E;try{for(C=this._options.preload;C>0;C--){G=new q.Picture();E=I.getData(D);G.add(this.isFullscreen()&&"big" in E?E.big:E.image);D=I.getNext(D)}}catch(B){}}v.show(F.container);a(I._thumbnails[H.index].container).addClass("active").siblings(".active").removeClass("active");I.trigger({type:q.LOADSTART,cached:y,index:H.index,imageTarget:F.image,thumbTarget:K.image});F.load(J,function(L){I._scaleImage(L,{complete:function(M){if("image" in x){v.toggleQuality(x.image,false)}v.toggleQuality(M.image,false);I._queue.stalled=true;I.removePan();I.setInfo(H.index);I.setCounter(H.index);I.trigger({type:q.LOADFINISH,cached:y,index:H.index,imageTarget:M.image,thumbTarget:I._thumbnails[H.index].image});var O=x.image===null&&I._options.initialTransition!==u?I._options.initialTransition:I._options.transition;if(O in m===false){z()}else{var N={prev:x.container,next:M.container,rewind:H.rewind,speed:I._options.transitionSpeed||400};m[O].call(I,N,z)}}})})},getNext:function(x){x=typeof x==="number"?x:this.getIndex();return x===this.getDataLength()-1?0:x+1},getPrev:function(x){x=typeof x==="number"?x:this.getIndex();return x===0?this.getDataLength()-1:x-1},next:function(){if(this.getDataLength()>1){this.show(this.getNext(),false)}return this},prev:function(){if(this.getDataLength()>1){this.show(this.getPrev(),true)}return this},get:function(x){return x in this._dom?this._dom[x]:null},getData:function(x){return x in this._data?this._data[x]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return typeof this._active==="number"?this._active:false},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(x){return typeof x==="undefined"?this._options:this._options[x]},setOptions:function(x,y){if(typeof x==="object"){a.extend(this._options,x)}else{this._options[x]=y}return this},play:function(x){this._playing=true;this._playtime=x||this._playtime;this._playCheck();this.trigger(q.PLAY);return this},pause:function(){this._playing=false;this.trigger(q.PAUSE);return this},playToggle:function(x){return(this._playing)?this.pause():this.play(x)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var B=this,A=0,y=20,z=v.timestamp(),C="play"+this._id;if(this._playing){v.clearTimer(C);var x=function(){A=v.timestamp()-z;if(A>=B._playtime&&B._playing){v.clearTimer(C);B.next();return}if(B._playing){B.trigger({type:q.PROGRESS,percent:Math.ceil(A/B._playtime*100),seconds:Math.floor(A/1000),milliseconds:A});v.addTimer(C,x,y)}};v.addTimer(C,x,y)}},setIndex:function(x){this._active=x;return this},setCounter:function(y){if(typeof y==="number"){y++}else{if(typeof y==="undefined"){y=this.getIndex()+1}}this.get("current").innerHTML=y;if(s){var x=this.$("counter"),z=x.css("opacity"),A=x.attr("style");if(A&&parseInt(z,10)===1){x.attr("style",A.replace(/filter[^\;]+\;/i,""))}else{this.$("counter").css("opacity",z)}}return this},setInfo:function(y){var z=this,x=this.getData(y);a.each(["title","description"],function(B,C){var A=z.$("info-"+C);if(!!x[C]){A[x[C].length?"show":"hide"]().html(x[C])}else{A.empty().hide()}});return this},hasInfo:function(z){var x="title description".split(" "),y;for(y=0;x[y];y++){if(!!this.getData(z)[x[y]]){return true}}return false},jQuery:function(A){var z=this,y=[];a.each(A.split(","),function(C,B){B=a.trim(B);if(z.get(B)){y.push(B)}});var x=a(z.get(y.shift()));a.each(y,function(C,B){x=x.add(z.get(B))});return x},$:function(x){return this.jQuery.apply(this,v.array(arguments))}};a.each(f,function(y,x){var z=/_/.test(x)?x.replace(/_/g,""):x;q[x.toUpperCase()]="galleria."+z});a.extend(q,{IE9:s===9,IE8:s===8,IE7:s===7,IE6:s===6,IE:!!s,WEBKIT:/webkit/.test(t),SAFARI:/safari/.test(t),CHROME:/chrome/.test(t),QUIRK:(s&&o.compatMode&&o.compatMode==="BackCompat"),MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!w.opera,IPHONE:/iphone/.test(t),IPAD:/ipad/.test(t),ANDROID:/android/.test(t),TOUCH:("ontouchstart" in document)});q.addTheme=function(z){if(!z.name){q.raise("No theme name specified")}if(typeof z.defaults!=="object"){z.defaults={}}else{z.defaults=j(z.defaults)}var x=false,y;if(typeof z.css==="string"){a("link").each(function(A,B){y=new RegExp(z.css);if(y.test(B.href)){x=true;q.theme=z;return false}});if(!x){a("script").each(function(A,B){y=new RegExp("galleria\\."+z.name.toLowerCase()+"\\.");if(y.test(B.src)){x=B.src.replace(/[^\/]*$/,"")+z.css;v.addTimer("css",function(){v.loadCSS(x,"galleria-theme",function(){q.theme=z})},1)}})}if(!x){q.raise("No theme CSS loaded")}}else{q.theme=z}return z};q.loadTheme=function(A,z){var y=false,x=g.length;q.theme=u;v.loadScript(A,function(){y=true});v.wait({until:function(){return y},error:function(){q.raise("Theme at "+A+" could not load, check theme path.",true)},success:function(){if(x){var B=[];a.each(q.get(),function(D,E){var F=a.extend(E._original.options,{data_source:E._data},z);E.$("container").remove();var C=new q();C._id=E._id;C.init(E._original.target,F);B.push(C)});g=B}},timeout:2000})};q.get=function(x){if(!!i[x]){return i[x]}else{if(typeof x!=="number"){return i}else{q.raise("Gallery index "+x+" not found")}}};q.addTransition=function(y,x){m[y]=x};q.utils=v;q.log=function(){try{w.console.log.apply(w.console,v.array(arguments))}catch(x){try{w.opera.postError.apply(w.opera,arguments)}catch(y){w.alert(v.array(arguments).split(", "))}}};q.ready=function(x){q.ready.callbacks.push(x)};q.ready.callbacks=[];q.raise=function(z,y){var B=y?"Fatal error":"Error",A=this,x=function(D){var C='<div style="padding:4px;margin:0 0 2px;background:#'+(y?"811":"222")+'";>'+(y?"<strong>"+B+": </strong>":"")+D+"</div>";a.each(i,function(){var E=this.$("errors"),F=this.$("target");if(!E.length){F.css("position","relative");E=this.addElement("errors").appendChild("target","errors").$("errors").css({color:"#fff",position:"absolute",top:0,left:0,zIndex:100000})}E.append(C)})};if(n){x(z);if(y){throw new Error(B+": "+z)}}else{if(y){if(h){return}h=true;y=false;x("Image gallery could not load.")}}};q.Picture=function(x){this.id=x||null;this.image=null;this.container=v.create("galleria-image");a(this.container).css({overflow:"hidden",position:"relative"});this.original={width:0,height:0};this.ready=false;this.loaded=false};q.Picture.prototype={cache:{},add:function(B){var x=0,A=this,y=new Image(),z=function(){if((!this.width||!this.height)&&x<1000){x++;a(y).load(z).attr("src",B+"?"+new Date().getTime())}A.original={height:this.height,width:this.width};A.cache[B]=B;A.loaded=true};a(y).css("display","block");if(A.cache[B]){y.src=B;z.call(y);return y}a(y).load(z).error(function(){q.raise("image could not load: "+B)}).attr("src",B);return y},show:function(){v.show(this.image)},hide:function(){v.moveOut(this.image)},clear:function(){this.image=null},isCached:function(x){return !!this.cache[x]},load:function(z,x){var y=this;a(this.container).empty(true);this.image=this.add(z);v.hide(this.image);a(this.container).append(this.image);v.wait({until:function(){return y.loaded&&y.image.complete&&y.original.width&&y.image.width},success:function(){w.setTimeout(function(){x.call(y,y)},1)},error:function(){w.setTimeout(function(){x.call(y,y)},1);q.raise("image not loaded in 30 seconds: "+z)},timeout:30000});return this.container},scale:function(A){A=a.extend({width:0,height:0,min:u,max:u,margin:0,complete:function(){},position:"center",crop:false,canvas:false},A);if(!this.image){return this.container}var C,z,B=this,x=a(B.container),y;v.wait({until:function(){C=A.width||x.width()||v.parseValue(x.css("width"));z=A.height||x.height()||v.parseValue(x.css("height"));return C&&z},success:function(){var I=(C-A.margin*2)/B.original.width,H=(z-A.margin*2)/B.original.height,E={"true":Math.max(I,H),width:I,height:H,"false":Math.min(I,H)},L=E[A.crop.toString()],D="";if(A.max){L=Math.min(A.max,L)}if(A.min){L=Math.max(A.min,L)}a.each(["width","height"],function(M,N){a(B.image)[N](B[N]=B.image[N]=Math.round(B.original[N]*L))});a(B.container).width(C).height(z);if(A.canvas&&d){d.elem.width=B.width;d.elem.height=B.height;D=B.image.src+":"+B.width+"x"+B.height;B.image.src=d.cache[D]||(function(N){d.context.drawImage(B.image,0,0,B.original.width*L,B.original.height*L);try{y=d.elem.toDataURL();d.length+=y.length;d.cache[N]=y;return y}catch(M){return B.image.src}}(D))}var J={},G={},F=function(R,P,O){var Q=0;if(/\%/.test(R)){var M=parseInt(R,10)/100,N=B.image[P]||a(B.image)[P]();Q=Math.ceil(N*-1*M+O*M)}else{Q=v.parseValue(R)}return Q},K={top:{top:0},left:{left:0},right:{left:"100%"},bottom:{top:"100%"}};a.each(A.position.toLowerCase().split(" "),function(M,N){if(N==="center"){N="50%"}J[M?"top":"left"]=N});a.each(J,function(M,N){if(K.hasOwnProperty(N)){a.extend(G,K[N])}});J=J.top?a.extend(J,G):G;J=a.extend({top:"50%",left:"50%"},J);a(B.image).css({position:"relative",top:F(J.top,"height",z),left:F(J.left,"width",C)});B.show();B.ready=true;A.complete.call(B,B)},error:function(){q.raise("Could not scale image: "+B.image.src)},timeout:1000});return this}};a.extend(a.easing,{galleria:function(x,B,y,z,A){if((B/=A/2)<1){return z/2*B*B*B+y}return z/2*((B-=2)*B*B+2)+y},galleriaIn:function(x,B,y,z,A){return z*(B/=A)*B+y},galleriaOut:function(x,B,y,z,A){return -z*(B/=A)*(B-2)+y}});a.fn.galleria=function(x){return this.each(function(){var y=new q();y.init(this,x)})};w.Galleria=q}(jQuery));