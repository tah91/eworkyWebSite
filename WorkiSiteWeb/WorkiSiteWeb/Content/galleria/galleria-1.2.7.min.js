(function(a){var C,G=this,s=G.document,b=a(s),c=a(G),A=Array.prototype,E=1.27,r=true,B=30000,u=false,z=navigator.userAgent.toLowerCase(),x=G.location.hash.replace(/#\//,""),v=function(){},w=function(){return false},y=(function(){var I=3,H=s.createElement("div"),F=H.getElementsByTagName("i");do{H.innerHTML="<!--[if gt IE "+(++I)+"]><i></i><![endif]-->"}while(F[0]);return I>4?I:C}()),t=function(){return{html:s.documentElement,body:s.body,head:s.getElementsByTagName("head")[0],title:s.title}},e="data ready thumbnail loadstart loadfinish image play pause progress fullscreen_enter fullscreen_exit idle_enter idle_exit rescale lightbox_open lightbox_close lightbox_image",f=(function(){var F=[];a.each(e.split(" "),function(I,H){F.push(H);if(/_/.test(H)){F.push(H.replace(/_/g,""))}});return F}()),j=function(H){var F;if(typeof H!=="object"){return H}a.each(H,function(I,J){if(/^[a-z]+_/.test(I)){F="";a.each(I.split("_"),function(K,L){F+=K>0?L.substr(0,1).toUpperCase()+L.substr(1):L});H[F]=J;delete H[I]}});return H},k=function(F){if(a.inArray(F,f)>-1){return Galleria[F.toUpperCase()]}return F},p={youtube:{reg:/https?:\/\/(?:[a-zA_Z]{2,3}.)?(?:youtube\.com\/watch\?)((?:[\w\d\-\_\=]+&amp;(?:amp;)?)*v(?:&lt;[A-Z]+&gt;)?=([0-9a-zA-Z\-\_]+))/i,embed:function(F){return"http://www.youtube.com/embed/"+F},getThumb:function(H,I,F){F=F||v;a.getJSON("http://gdata.youtube.com/feeds/api/videos/"+H+"?v=2&alt=json-in-script&callback=?",function(J){try{I(J.entry.media$group.media$thumbnail[0].url)}catch(K){F()}}).error(F)}},vimeo:{reg:/https?:\/\/(?:www\.)?(vimeo\.com)\/(?:hd#)?([0-9]+)/i,embed:function(F){return"http://player.vimeo.com/video/"+F},getThumb:function(H,I,F){F=F||v;a.getJSON("http://vimeo.com/api/v2/video/"+H+".json?callback=?",function(J){try{I(J[0].thumbnail_medium)}catch(K){F()}}).error(F)}},dailymotion:{reg:/https?:\/\/(?:www\.)?(dailymotion\.com)\/video\/([^_]+)/,embed:function(F){return"http://www.dailymotion.com/embed/video/"+F},getThumb:function(H,I,F){F=F||v;a.getJSON("https://api.dailymotion.com/video/"+H+"?fields=thumbnail_medium_url&callback=?",function(J){try{I(J.thumbnail_medium_url)}catch(K){F()}}).error(F)}}},q=function(H){var F;for(var I in p){F=H&&H.match(p[I].reg);if(F&&F.length){return{id:F[2],provider:I}}}return false},n={trunk:{},add:function(I,H,F,J){I=I||new Date().getTime();J=J||false;this.clear(I);if(J){var K=H;H=function(){K();n.add(I,H,F)}}this.trunk[I]=G.setTimeout(H,F)},clear:function(I){var F=function(J){G.clearTimeout(this.trunk[J]);delete this.trunk[J]},H;if(!!I&&I in this.trunk){F.call(n,I)}else{if(typeof I==="undefined"){for(H in this.trunk){if(this.trunk.hasOwnProperty(H)){F.call(n,H)}}}}}},g=[],i=[],h=false,d=false,l=[],m=function(F){Galleria.theme=F;a.each(l,function(H,I){if(!I._initialized){I._init.call(I)}})},D=(function(){return{array:function(F){return A.slice.call(F,0)},create:function(F,I){I=I||"div";var H=s.createElement(I);H.className=F;return H},getScriptPath:function(H){H=H||a("script:last").attr("src");var F=H.split("/");if(F.length==1){return""}F.pop();return F.join("/")+"/"},animate:(function(){var R=(function(U){var T="transition WebkitTransition MozTransition OTransition".split(" "),S;if(G.opera){return false}for(S=0;T[S];S++){if(typeof U[T[S]]!=="undefined"){return T[S]}}return false}((s.body||s.documentElement).style));var L={MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[R];var K={_default:[0.25,0.1,0.25,1],galleria:[0.645,0.045,0.355,1],galleriaIn:[0.55,0.085,0.68,0.53],galleriaOut:[0.25,0.46,0.45,0.94],ease:[0.25,0,0.25,1],linear:[0.25,0.25,0.75,0.75],"ease-in":[0.42,0,1,1],"ease-out":[0,0,0.58,1],"ease-in-out":[0.42,0,0.58,1]};var O=function(T,V,U){var S={};U=U||"transition";a.each("webkit moz ms o".split(" "),function(){S["-"+this+"-"+U]=V});T.css(S)};var H=function(S){O(S,"none","transition");if(Galleria.WEBKIT&&Galleria.TOUCH){O(S,"translate3d(0,0,0)","transform");if(S.data("revert")){S.css(S.data("revert"));S.data("revert",null)}}};var F,P,J,Q,N,M,I;return function(S,U,T){T=a.extend({duration:400,complete:v,stop:false},T);S=a(S);if(!T.duration){S.css(U);T.complete.call(S[0]);return}if(!R){S.animate(U,T);return}if(T.stop){S.unbind(L);H(S)}F=false;a.each(U,function(V,W){I=S.css(V);if(D.parseValue(I)!=D.parseValue(W)){F=true}S.css(V,I)});if(!F){G.setTimeout(function(){T.complete.call(S[0])},T.duration);return}P=[];J=T.easing in K?K[T.easing]:K._default;Q=" "+T.duration+"ms cubic-bezier("+J.join(",")+")";G.setTimeout((function(V,W,Y,X){return function(){V.one(W,(function(Z){return function(){H(Z);T.complete.call(Z[0])}}(V)));if(Galleria.WEBKIT&&Galleria.TOUCH){N={};M=[0,0,0];a.each(["left","top"],function(Z,aa){if(aa in Y){M[Z]=(D.parseValue(Y[aa])-D.parseValue(V.css(aa)))+"px";N[aa]=Y[aa];delete Y[aa]}});if(M[0]||M[1]){V.data("revert",N);P.push("-webkit-transform"+X);O(V,"translate3d("+M.join(",")+")","transform")}}a.each(Y,function(Z,aa){P.push(Z+X)});O(V,P.join(","));V.css(Y)}}(S,L,U,Q)),2)}}()),removeAlpha:function(H){if(y<9&&H){var J=H.style,F=H.currentStyle,I=F&&F.filter||J.filter||"";if(/alpha/.test(I)){J.filter=I.replace(/alpha\([^)]*\)/i,"")}}},forceStyles:function(F,H){F=a(F);if(F.attr("style")){F.data("styles",F.attr("style")).removeAttr("style")}F.css(H)},revertStyles:function(){a.each(D.array(arguments),function(H,F){F=a(F);F.removeAttr("style");F.attr("style","");if(F.data("styles")){F.attr("style",F.data("styles")).data("styles",null)}})},moveOut:function(F){D.forceStyles(F,{position:"absolute",left:-10000})},moveIn:function(){D.revertStyles.apply(D,D.array(arguments))},elem:function(F){if(F instanceof a){return{$:F,dom:F[0]}}else{return{$:a(F),dom:F}}},hide:function(K,L,H){H=H||v;var J=D.elem(K),F=J.$;K=J.dom;if(!F.data("opacity")){F.data("opacity",F.css("opacity"))}var M={opacity:0};if(L){var I=y<9&&K?function(){D.removeAlpha(K);K.style.visibility="hidden";H.call(K)}:H;D.animate(K,M,{duration:L,complete:I,stop:true})}else{if(y<9&&K){D.removeAlpha(K);K.style.visibility="hidden"}else{F.css(M)}}},show:function(K,M,H){H=H||v;var J=D.elem(K),F=J.$;K=J.dom;var L=parseFloat(F.data("opacity"))||1,N={opacity:L};if(M){if(y<9){F.css("opacity",0);K.style.visibility="visible"}var I=y<9&&K?function(){if(N.opacity==1){D.removeAlpha(K)}H.call(K)}:H;D.animate(K,N,{duration:M,complete:I,stop:true})}else{if(y<9&&N.opacity==1&&K){D.removeAlpha(K);K.style.visibility="visible"}else{F.css(N)}}},optimizeTouch:(function(){var M,H,K,N,I={},L=function(O){O.preventDefault();I=a.extend({},O,true)},F=function(){this.evt=I},J=function(){this.handler.call(M,this.evt)};return function(O){a(O).bind("touchend",function(P){M=P.target;N=true;while(M.parentNode&&M!=P.currentTarget&&N){H=a(M).data("events");K=a(M).data("fakes");if(H&&"click" in H){N=false;P.preventDefault();a(M).click(L).click();H.click.pop();a.each(H.click,F);a(M).data("fakes",H.click);delete H.click}else{if(K){N=false;P.preventDefault();a.each(K,J)}}M=M.parentNode}})}}()),addTimer:function(){n.add.apply(n,D.array(arguments));return this},clearTimer:function(){n.clear.apply(n,D.array(arguments));return this},wait:function(J){J=a.extend({until:w,success:v,error:function(){Galleria.raise("Could not complete wait function.")},timeout:3000},J);var K=D.timestamp(),F,I,H=function(){I=D.timestamp();F=I-K;if(J.until(F)){J.success();return false}if(typeof J.timeout=="number"&&I>=K+J.timeout){J.error();return false}G.setTimeout(H,10)};G.setTimeout(H,10)},toggleQuality:function(H,F){if((y!==7&&y!==8)||!H||H.nodeName.toUpperCase()!="IMG"){return}if(typeof F==="undefined"){F=H.style.msInterpolationMode==="nearest-neighbor"}H.style.msInterpolationMode=F?"bicubic":"nearest-neighbor"},insertStyleTag:function(I){var H=s.createElement("style");t().head.appendChild(H);if(H.styleSheet){H.styleSheet.cssText=I}else{var F=s.createTextNode(I);H.appendChild(F)}},loadScript:function(J,F){var H=false,I=a("<script>").attr({src:J,async:true}).get(0);I.onload=I.onreadystatechange=function(){if(!H&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){H=true;I.onload=I.onreadystatechange=null;if(typeof F==="function"){F.call(this,this)}}};t().head.appendChild(I)},parseValue:function(H){if(typeof H==="number"){return H}else{if(typeof H==="string"){var F=H.match(/\-?\d|\./g);return F&&F.constructor===Array?F.join("")*1:0}else{return 0}}},timestamp:function(){return new Date().getTime()},loadCSS:function(H,I,F){var L,M=false,K,J=function(){var N=new Image();N.onload=N.onerror=function(O){N=null;M=true};N.src=H};a("link[rel=stylesheet]").each(function(){if(new RegExp(H).test(this.href)){L=this;return false}});if(typeof I==="function"){F=I;I=C}F=F||v;if(L){F.call(L,L);return L}K=s.styleSheets.length;if(a("#"+I).length){a("#"+I).attr("href",H);K--;M=true}else{L=a("<link>").attr({rel:"stylesheet",href:H,id:I}).get(0);G.setTimeout(function(){var P=a('link[rel="stylesheet"], style');if(P.length){P.get(0).parentNode.insertBefore(L,P[0])}else{t().head.appendChild(L)}if(y){if(K>=31){Galleria.raise("You have reached the browser stylesheet limit (31)",true);return}L.onreadystatechange=function(Q){if(!M&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){M=true}}}else{var N=s.createElement("a"),O=G.location;N.href=H;if(!(/file/.test(O.protocol))&&O.hostname==N.hostname&&O.port==N.port&&O.protocol==N.protocol){a.ajax({url:H,success:function(){M=true},error:J})}else{J()}}},10)}if(typeof F==="function"){D.wait({until:function(){return M&&s.styleSheets.length>K},success:function(){G.setTimeout(function(){F.call(L,L)},100)},error:function(){Galleria.raise("Theme CSS could not load",true)},timeout:10000})}return L}}}()),o=(function(){var F=function(N,H,L,J){var K=this.getOptions("easing"),I=this.getStageWidth(),M={left:I*(N.rewind?-1:1)},O={left:0};if(L){M.opacity=0;O.opacity=1}else{M.opacity=1}a(N.next).css(M);D.animate(N.next,O,{duration:N.speed,complete:(function(P){return function(){H();P.css({left:0})}}(a(N.next).add(N.prev))),queue:false,easing:K});if(J){N.rewind=!N.rewind}if(N.prev){M={left:0};O={left:I*(N.rewind?1:-1)};if(L){M.opacity=1;O.opacity=0}a(N.prev).css(M);D.animate(N.prev,O,{duration:N.speed,queue:false,easing:K,complete:function(){a(this).css("opacity",0)}})}};return{fade:function(I,H){a(I.next).css({opacity:0,left:0}).show();D.animate(I.next,{opacity:1},{duration:I.speed,complete:H});if(I.prev){a(I.prev).css("opacity",1).show();D.animate(I.prev,{opacity:0},{duration:I.speed})}},flash:function(I,H){a(I.next).css({opacity:0,left:0});if(I.prev){D.animate(I.prev,{opacity:0},{duration:I.speed/2,complete:function(){D.animate(I.next,{opacity:1},{duration:I.speed,complete:H})}})}else{D.animate(I.next,{opacity:1},{duration:I.speed,complete:H})}},pulse:function(I,H){if(I.prev){a(I.prev).hide()}a(I.next).css({opacity:0,left:0}).show();D.animate(I.next,{opacity:1},{duration:I.speed,complete:H})},slide:function(I,H){F.apply(this,D.array(arguments))},fadeslide:function(I,H){F.apply(this,D.array(arguments).concat([true]))},doorslide:function(I,H){F.apply(this,D.array(arguments).concat([false,true]))}}}());Galleria=function(){var N=this;this._options={};this._playing=false;this._playtime=5000;this._active=null;this._queue={length:0};this._data=[];this._dom={};this._thumbnails=[];this._layers=[];this._initialized=false;this._firstrun=false;this._stageWidth=0;this._stageHeight=0;this._target=C;this._id=parseInt(Math.random()*10000,10);var I="container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter tooltip",O="current total";a.each(I.split(" "),function(R,Q){N._dom[Q]=D.create("galleria-"+Q)});a.each(O.split(" "),function(R,Q){N._dom[Q]=D.create("galleria-"+Q,"span")});var L=this._keyboard={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:false,press:function(Q){var R=Q.keyCode||Q.which;if(R in L.map&&typeof L.map[R]==="function"){L.map[R].call(N,Q)}},attach:function(R){var Q,S;for(Q in R){if(R.hasOwnProperty(Q)){S=Q.toUpperCase();if(S in L.keys){L.map[L.keys[S]]=R[Q]}else{L.map[S]=R[Q]}}}if(!L.bound){L.bound=true;b.bind("keydown",L.press)}},detach:function(){L.bound=false;L.map={};b.unbind("keydown",L.press)}};var H=this._controls={0:C,1:C,active:0,swap:function(){H.active=H.active?0:1},getActive:function(){return H[H.active]},getNext:function(){return H[1-H.active]}};var F=this._carousel={next:N.$("thumb-nav-right"),prev:N.$("thumb-nav-left"),width:0,current:0,max:0,hooks:[],update:function(){var S=0,Q=0,R=[0];a.each(N._thumbnails,function(T,U){if(U.ready){S+=U.outerWidth||a(U.container).outerWidth(true);R[T+1]=S;Q=Math.max(Q,U.outerHeight||a(U.container).outerHeight(true))}});N.$("thumbnails").css({width:S,height:Q});F.max=S;F.hooks=R;F.width=N.$("thumbnails-list").width();F.setClasses();N.$("thumbnails-container").toggleClass("galleria-carousel",S>F.width);F.width=N.$("thumbnails-list").width()},bindControls:function(){var Q;F.next.bind("click",function(R){R.preventDefault();if(N._options.carouselSteps==="auto"){for(Q=F.current;Q<F.hooks.length;Q++){if(F.hooks[Q]-F.hooks[F.current]>F.width){F.set(Q-2);break}}}else{F.set(F.current+N._options.carouselSteps)}});F.prev.bind("click",function(R){R.preventDefault();if(N._options.carouselSteps==="auto"){for(Q=F.current;Q>=0;Q--){if(F.hooks[F.current]-F.hooks[Q]>F.width){F.set(Q+2);break}else{if(Q===0){F.set(0);break}}}}else{F.set(F.current-N._options.carouselSteps)}})},set:function(Q){Q=Math.max(Q,0);while(F.hooks[Q-1]+F.width>=F.max&&Q>=0){Q--}F.current=Q;F.animate()},getLast:function(Q){return(Q||F.current)-1},follow:function(Q){if(Q===0||Q===F.hooks.length-2){F.set(Q);return}var R=F.current;while(F.hooks[R]-F.hooks[F.current]<F.width&&R<=F.hooks.length){R++}if(Q-1<F.current){F.set(Q-1)}else{if(Q+2>R){F.set(Q-R+F.current+2)}}},setClasses:function(){F.prev.toggleClass("disabled",!F.current);F.next.toggleClass("disabled",F.hooks[F.current]+F.width>=F.max)},animate:function(R){F.setClasses();var Q=F.hooks[F.current]*-1;if(isNaN(Q)){return}D.animate(N.get("thumbnails"),{left:Q},{duration:N._options.carouselSpeed,easing:N._options.easing,queue:false})}};var P=this._tooltip={initialized:false,open:false,timer:"tooltip"+N._id,swapTimer:"swap"+N._id,init:function(){P.initialized=true;var Q=".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}";D.insertStyleTag(Q);N.$("tooltip").css("opacity",0.8);D.hide(N.get("tooltip"))},move:function(R){var W=N.getMousePosition(R).x,X=N.getMousePosition(R).y,Q=N.$("tooltip"),Z=W,aa=X,S=Q.outerHeight(true)+1,Y=Q.outerWidth(true),T=S+15;var U=N.$("container").width()-Y-2,V=N.$("container").height()-S-2;if(!isNaN(Z)&&!isNaN(aa)){Z+=10;aa-=30;Z=Math.max(0,Math.min(U,Z));aa=Math.max(0,Math.min(V,aa));if(X<T){aa=T}Q.css({left:Z,top:aa})}},bind:function(Q,S){if(Galleria.TOUCH){return}if(!P.initialized){P.init()}var R=function(T,U){P.define(T,U);a(T).hover(function(){D.clearTimer(P.swapTimer);N.$("container").unbind("mousemove",P.move).bind("mousemove",P.move).trigger("mousemove");P.show(T);D.addTimer(P.timer,function(){N.$("tooltip").stop().show().animate({opacity:1});P.open=true},P.open?0:500)},function(){N.$("container").unbind("mousemove",P.move);D.clearTimer(P.timer);N.$("tooltip").stop().animate({opacity:0},200,function(){N.$("tooltip").hide();D.addTimer(P.swapTimer,function(){P.open=false},1000)})}).click(function(){a(this).trigger("mouseout")})};if(typeof S==="string"){R((Q in N._dom?N.get(Q):Q),S)}else{a.each(Q,function(T,U){R(N.get(T),U)})}},show:function(Q){Q=a(Q in N._dom?N.get(Q):Q);var S=Q.data("tt"),R=function(T){G.setTimeout((function(U){return function(){P.move(U)}}(T)),10);Q.unbind("mouseup",R)};S=typeof S==="function"?S():S;if(!S){return}N.$("tooltip").html(S.replace(/\s/,"&nbsp;"));Q.bind("mouseup",R)},define:function(Q,S){if(typeof S!=="function"){var R=S;S=function(){return R}}Q=a(Q in N._dom?N.get(Q):Q).data("tt",S);P.show(Q)}};var J=this._fullscreen={scrolled:0,crop:C,transition:C,active:false,keymap:N._keyboard.map,os:{callback:v,support:(function(){var Q=t().html;return Q.requestFullscreen||Q.mozRequestFullScreen||Q.webkitRequestFullScreen}()),enter:function(Q){J.os.callback=Q||v;var R=t().html;if(R.requestFullscreen){R.requestFullscreen()}else{if(R.mozRequestFullScreen){R.mozRequestFullScreen()}else{if(R.webkitRequestFullScreen){R.webkitRequestFullScreen()}}}},exit:function(Q){J.os.callback=Q||v;if(s.exitFullscreen){s.exitFullscreen()}else{if(s.mozCancelFullScreen){s.mozCancelFullScreen()}else{if(s.webkitCancelFullScreen){s.webkitCancelFullScreen()}}}},listen:function(){if(!J.os.support){return}var Q=function(){if(s.fullscreen||s.mozFullScreen||s.webkitIsFullScreen){J._enter(J.os.callback)}else{J._exit(J.os.callback)}};s.addEventListener("fullscreenchange",Q,false);s.addEventListener("mozfullscreenchange",Q,false);s.addEventListener("webkitfullscreenchange",Q,false)}},enter:function(Q){if(N._options.trueFullscreen&&J.os.support){J.os.enter(Q)}else{J._enter(Q)}},_enter:function(S){J.active=true;D.hide(N.getActiveImage());N.$("container").addClass("fullscreen");J.scrolled=c.scrollTop();D.forceStyles(N.get("container"),{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:10000});var U={height:"100%",overflow:"hidden",margin:0,padding:0},T=N.getData(),W=N._options;D.forceStyles(t().html,U);D.forceStyles(t().body,U);J.keymap=a.extend({},N._keyboard.map);N.attachKeyboard({escape:N.exitFullscreen,right:N.next,left:N.prev});J.crop=W.imageCrop;if(W.fullscreenCrop!=C){W.imageCrop=W.fullscreenCrop}if(T&&T.big&&T.image!==T.big){var Q=new Galleria.Picture(),R=Q.isCached(T.big),V=N.getIndex(),X=N._thumbnails[V];N.trigger({type:Galleria.LOADSTART,cached:R,rewind:false,index:V,imageTarget:N.getActiveImage(),thumbTarget:X,galleriaData:T});Q.load(T.big,function(Y){N._scaleImage(Y,{complete:function(Z){N.trigger({type:Galleria.LOADFINISH,cached:R,index:V,rewind:false,imageTarget:Z.image,thumbTarget:X});var aa=N._controls.getActive().image;if(aa){a(aa).width(Z.image.width).height(Z.image.height).attr("style",a(Z.image).attr("style")).attr("src",Z.image.src)}}})})}N.rescale(function(){D.addTimer(false,function(){D.show(N.getActiveImage());if(typeof S==="function"){S.call(N)}},100);N.trigger(Galleria.FULLSCREEN_ENTER)});c.resize(function(){J.scale()})},scale:function(){N.rescale()},exit:function(Q){if(N._options.trueFullscreen&&J.os.support){J.os.exit(Q)}else{J._exit(Q)}},_exit:function(R){J.active=false;D.hide(N.getActiveImage());N.$("container").removeClass("fullscreen");D.revertStyles(N.get("container"),t().html,t().body);G.scrollTo(0,J.scrolled);N.detachKeyboard();N.attachKeyboard(J.keymap);N._options.imageCrop=J.crop;var Q=N.getData().big,S=N._controls.getActive().image;if(!N.getData().iframe&&S&&Q&&Q==S.src){G.setTimeout(function(T){return function(){S.src=T}}(N.getData().image),1)}N.rescale(function(){D.addTimer(false,function(){D.show(N.getActiveImage());if(typeof R==="function"){R.call(N)}c.trigger("resize")},50);N.trigger(Galleria.FULLSCREEN_EXIT)});c.unbind("resize",J.scale)}};J.os.listen();var K=this._idle={timer:"idle"+N._id,trunk:[],bound:false,add:function(Q,T){if(!Q){return}if(!K.bound){K.addEvent()}Q=a(Q);var R={},S;for(S in T){if(T.hasOwnProperty(S)){R[S]=Q.css(S)}}Q.data("idle",{from:R,to:T,complete:true,busy:false});K.addTimer();K.trunk.push(Q)},remove:function(Q){Q=jQuery(Q);a.each(K.trunk,function(S,R){if(R&&R.length&&!R.not(Q).length){N._idle.show(Q);N._idle.trunk.splice(S,1)}});if(!K.trunk.length){K.removeEvent();D.clearTimer(K.timer)}},addEvent:function(){K.bound=true;N.$("container").bind("mousemove click",K.showAll)},removeEvent:function(){K.bound=false;N.$("container").unbind("mousemove click",K.showAll)},addTimer:function(){D.addTimer(K.timer,function(){K.hide()},N._options.idleTime)},hide:function(){if(!N._options.idleMode||N.getIndex()===false||N.getData().iframe){return}N.trigger(Galleria.IDLE_ENTER);a.each(K.trunk,function(S,R){var Q=R.data("idle");if(!Q){return}R.data("idle").complete=false;D.animate(R,Q.to,{duration:N._options.idleSpeed})})},showAll:function(){D.clearTimer(K.timer);a.each(K.trunk,function(R,Q){K.show(Q)})},show:function(R){var Q=R.data("idle");if(!Q.busy&&!Q.complete){Q.busy=true;N.trigger(Galleria.IDLE_EXIT);D.clearTimer(K.timer);D.animate(R,Q.from,{duration:N._options.idleSpeed/2,complete:function(){a(this).data("idle").busy=false;a(this).data("idle").complete=true}})}K.addTimer()}};var M=this._lightbox={width:0,height:0,initialized:false,active:null,image:null,elems:{},keymap:false,init:function(){N.trigger(Galleria.LIGHTBOX_OPEN);if(M.initialized){return}M.initialized=true;var V="overlay box content shadow title info close prevholder prev nextholder next counter image",U={},X=N._options,S="",Q="position:absolute;",Y="lightbox-",T={overlay:"position:fixed;display:none;opacity:"+X.overlayOpacity+";filter:alpha(opacity="+(X.overlayOpacity*100)+");top:0;left:0;width:100%;height:100%;background:"+X.overlayBackground+";z-index:99990",box:"position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",shadow:Q+"background:#000;width:100%;height:100%;",content:Q+"background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",info:Q+"bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",close:Q+"top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",image:Q+"top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",prevholder:Q+"width:50%;top:0;bottom:40px;cursor:pointer;",nextholder:Q+"width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",prev:Q+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",next:Q+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",title:"float:left",counter:"float:right;margin-left:8px;"},W=function(Z){return Z.hover(function(){a(this).css("color","#bbb")},function(){a(this).css("color","#444")})},R={};if(y&&y>7){T.nextholder+="background:#000;filter:alpha(opacity=0);";T.prevholder+="background:#000;filter:alpha(opacity=0);"}a.each(T,function(Z,aa){S+=".galleria-"+Y+Z+"{"+aa+"}"});S+=".galleria-"+Y+"box.iframe .galleria-"+Y+"prevholder,.galleria-"+Y+"box.iframe .galleria-"+Y+"nextholder{width:100px;height:100px;top:50%;margin-top:-70px}";D.insertStyleTag(S);a.each(V.split(" "),function(aa,Z){N.addElement("lightbox-"+Z);U[Z]=M.elems[Z]=N.get("lightbox-"+Z)});M.image=new Galleria.Picture();a.each({box:"shadow content close prevholder nextholder",info:"title counter",content:"info image",prevholder:"prev",nextholder:"next"},function(aa,ab){var Z=[];a.each(ab.split(" "),function(ac,ad){Z.push(Y+ad)});R[Y+aa]=Z});N.append(R);a(U.image).append(M.image.container);a(t().body).append(U.overlay,U.box);D.optimizeTouch(U.box);W(a(U.close).bind("click",M.hide).html("&#215;"));a.each(["Prev","Next"],function(ac,ab){var Z=a(U[ab.toLowerCase()]).html(/v/.test(ab)?"&#8249;&nbsp;":"&nbsp;&#8250;"),aa=a(U[ab.toLowerCase()+"holder"]);aa.bind("click",function(){M["show"+ab]()});if(y<8||Galleria.TOUCH){Z.show();return}aa.hover(function(){Z.show()},function(ad){Z.stop().fadeOut(200)})});a(U.overlay).bind("click",M.hide);if(Galleria.IPAD){N._options.lightboxTransitionSpeed=0}},rescale:function(S){var W=Math.min(c.width()-40,M.width),T=Math.min(c.height()-60,M.height),U=Math.min(W/M.width,T/M.height),R=Math.round(M.width*U)+40,Q=Math.round(M.height*U)+60,V={width:R,height:Q,"margin-top":Math.ceil(Q/2)*-1,"margin-left":Math.ceil(R/2)*-1};if(S){a(M.elems.box).css(V)}else{a(M.elems.box).animate(V,{duration:N._options.lightboxTransitionSpeed,easing:N._options.easing,complete:function(){var X=M.image,Y=N._options.lightboxFadeSpeed;N.trigger({type:Galleria.LIGHTBOX_IMAGE,imageTarget:X.image});a(X.container).show();a(X.image).animate({opacity:1},Y);D.show(M.elems.info,Y)}})}},hide:function(){M.image.image=null;c.unbind("resize",M.rescale);a(M.elems.box).hide();D.hide(M.elems.info);N.detachKeyboard();N.attachKeyboard(M.keymap);M.keymap=false;D.hide(M.elems.overlay,200,function(){a(this).hide().css("opacity",N._options.overlayOpacity);N.trigger(Galleria.LIGHTBOX_CLOSE)})},showNext:function(){M.show(N.getNext(M.active))},showPrev:function(){M.show(N.getPrev(M.active))},show:function(T){M.active=T=typeof T==="number"?T:N.getIndex()||0;if(!M.initialized){M.init()}if(!M.keymap){M.keymap=a.extend({},N._keyboard.map);N.attachKeyboard({escape:M.hide,right:M.showNext,left:M.showPrev})}c.unbind("resize",M.rescale);var Q=N.getData(T),X=N.getDataLength(),U=N.getNext(T),V,W,S;D.hide(M.elems.info);try{for(S=N._options.preload;S>0;S--){W=new Galleria.Picture();V=N.getData(U);W.preload("big" in V?V.big:V.image);U=N.getNext(U)}}catch(R){}M.image.isIframe=!!Q.iframe;a(M.elems.box).toggleClass("iframe",!!Q.iframe);M.image.load(Q.iframe||Q.big||Q.image,function(Y){M.width=Y.isIframe?a(G).width():Y.original.width;M.height=Y.isIframe?a(G).height():Y.original.height;a(Y.image).css({width:Y.isIframe?"100%":"100.1%",height:Y.isIframe?"100%":"100.1%",top:0,zIndex:99998,opacity:0,visibility:"visible"});M.elems.title.innerHTML=Q.title||"";M.elems.counter.innerHTML=(T+1)+" / "+X;c.resize(M.rescale);M.rescale()});a(M.elems.overlay).show().css("visibility","visible");a(M.elems.box).show()}};return this};Galleria.prototype={constructor:Galleria,init:function(I,F){var H=this;F=j(F);this._original={target:I,options:F,data:null};this._target=this._dom.target=I.nodeName?I:a(I).get(0);this._original.html=this._target.innerHTML;i.push(this);if(!this._target){Galleria.raise("Target not found",true);return}this._options={autoplay:false,carousel:true,carouselFollow:true,carouselSpeed:400,carouselSteps:"auto",clicknext:false,dailymotion:{foreground:"%23EEEEEE",highlight:"%235BCEC5",background:"%23222222",logo:0,hideInfos:1},dataConfig:function(J){return{}},dataSelector:"img",dataSource:this._target,debug:C,dummy:C,easing:"galleria",extend:function(J){},fullscreenCrop:C,fullscreenDoubleTap:true,fullscreenTransition:C,height:0,idleMode:true,idleTime:3000,idleSpeed:200,imageCrop:false,imageMargin:0,imagePan:false,imagePanSmoothness:12,imagePosition:"50%",imageTimeout:C,initialTransition:C,keepSource:false,layerFollow:true,lightbox:false,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceImages:true,maxScaleRatio:C,minScaleRatio:C,overlayOpacity:0.85,overlayBackground:"#0b0b0b",pauseOnInteraction:true,popupLinks:false,preload:2,queue:true,responsive:false,show:0,showInfo:true,showCounter:true,showImagenav:true,swipe:true,thumbCrop:true,thumbEventType:"click",thumbFit:true,thumbMargin:0,thumbQuality:"auto",thumbnails:true,touchTransition:C,transition:"fade",transitionInitial:C,transitionSpeed:400,trueFullscreen:true,useCanvas:false,vimeo:{title:0,byline:0,portrait:0,color:"aaaaaa"},wait:5000,width:"auto",youtube:{modestbranding:1,autohide:1,color:"white",hd:1,rel:0,showinfo:0}};this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial;if(F&&F.debug===false){r=false}if(F&&typeof F.imageTimeout==="number"){B=F.imageTimeout}if(F&&typeof F.dummy==="string"){u=F.dummy}a(this._target).children().hide();if(typeof Galleria.theme==="object"){this._init()}else{l.push(this)}return this},_init:function(){var I=this,H=this._options;if(this._initialized){Galleria.raise("Init failed: Gallery instance already initialized.");return this}this._initialized=true;if(!Galleria.theme){Galleria.raise("Init failed: No theme found.",true);return this}a.extend(true,H,Galleria.theme.defaults,this._original.options,Galleria.configure.options);(function(K){if(!("getContext" in K)){K=null;return}d=d||{elem:K,context:K.getContext("2d"),cache:{},length:0}}(s.createElement("canvas")));this.bind(Galleria.DATA,function(){if(Galleria.QUIRK){Galleria.raise("Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML.")}this._original.data=this._data;this.get("total").innerHTML=this.getDataLength();var K=this.$("container");var L={width:0,height:0};var M=function(){return I.$("stage").height()};D.wait({until:function(){L=I._getWH();K.width(L.width).height(L.height);return M()&&L.width&&L.height>50},success:function(){I._width=L.width;I._height=L.height;if(Galleria.WEBKIT){G.setTimeout(function(){I._run()},1)}else{I._run()}},error:function(){if(M()){Galleria.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:"+L.width+"px, height: "+L.height+"px.",true)}else{Galleria.raise("Could not extract a stage height from the CSS. Traced height: "+M()+"px.",true)}},timeout:typeof this._options.wait=="number"?this._options.wait:false})});this.append({"info-text":["info-title","info-description"],info:["info-text"],"image-nav":["image-nav-right","image-nav-left"],stage:["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],container:["stage","thumbnails-container","info","tooltip"]});D.hide(this.$("counter").append(this.get("current"),s.createTextNode(" / "),this.get("total")));this.setCounter("&#8211;");D.hide(I.get("tooltip"));this.$("container").addClass(Galleria.TOUCH?"touch":"notouch");a.each(new Array(2),function(K){var L=new Galleria.Picture();a(L.container).css({position:"absolute",top:0,left:0}).prepend(I._layers[K]=a(D.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]);I.$("images").append(L.container);I._controls[K]=L});this.$("images").css({position:"relative",top:0,left:0,width:"100%",height:"100%"});this.$("thumbnails, thumbnails-list").css({overflow:"hidden",position:"relative"});this.$("image-nav-right, image-nav-left").bind("click",function(K){if(H.clicknext){K.stopPropagation()}if(H.pauseOnInteraction){I.pause()}var L=/right/.test(this.className)?"next":"prev";I[L]()});a.each(["info","counter","image-nav"],function(L,K){if(H["show"+K.substr(0,1).toUpperCase()+K.substr(1).replace(/-/,"")]===false){D.moveOut(I.get(K.toLowerCase()))}});this.load();if(!H.keepSource&&!y){this._target.innerHTML=""}if(this.get("errors")){this.appendChild("target","errors")}this.appendChild("target","container");if(H.carousel){var F=0,J=H.show;this.bind(Galleria.THUMBNAIL,function(){this.updateCarousel();if(++F==this.getDataLength()&&typeof J=="number"&&J>0){this._carousel.follow(J)}})}if(H.responsive){c.bind("resize",function(){if(!I.isFullscreen()){I.resize()}})}if(H.swipe){(function(N){var S=[0,0],T=[0,0],O=30,P=100,R=false,U=0,K,L={start:"touchstart",move:"touchmove",stop:"touchend"},M=function(W){return W.originalEvent.touches?W.originalEvent.touches[0]:W},Q=function(W){if(W.originalEvent.touches&&W.originalEvent.touches.length>1){return}K=M(W);T=[K.pageX,K.pageY];if(!S[0]){S=T}if(Math.abs(S[0]-T[0])>10){W.preventDefault()}},V=function(W){N.unbind(L.move,Q);if((W.originalEvent.touches&&W.originalEvent.touches.length)||R){R=!R;return}if(D.timestamp()-U<1000&&Math.abs(S[0]-T[0])>O&&Math.abs(S[1]-T[1])<P){W.preventDefault();I[S[0]>T[0]?"next":"prev"]()}S=T=[0,0]};N.bind(L.start,function(W){if(W.originalEvent.touches&&W.originalEvent.touches.length>1){return}K=M(W);U=D.timestamp();S=T=[K.pageX,K.pageY];N.bind(L.move,Q).one(L.stop,V)})}(I.$("images")));if(H.fullscreenDoubleTap){this.$("stage").bind("touchstart",(function(){var N,K,L,O,P,Q,M=function(R){return R.originalEvent.touches?R.originalEvent.touches[0]:R};return function(R){Q=Galleria.utils.timestamp();K=M(R).pageX;L=M(R).pageY;if((Q-N<500)&&(K-O<20)&&(L-P<20)){I.toggleFullscreen();R.preventDefault();I.$("stage").unbind("touchend",arguments.callee);return}N=Q;O=K;P=L}}()))}}D.optimizeTouch(this.get("container"));a.each(Galleria.on.binds,function(L,K){I.bind(K.type,K.callback)});return this},_getWH:function(){var F=this.$("container"),H=this.$("target"),K=this,J={},I;a.each(["width","height"],function(L,M){if(K._options[M]&&typeof K._options[M]==="number"){J[M]=K._options[M]}else{I=[D.parseValue(F.css(M)),D.parseValue(H.css(M)),F[M](),H[M]()];if(!K["_"+M]){I.splice(I.length,D.parseValue(F.css("min-"+M)),D.parseValue(H.css("min-"+M)))}J[M]=Math.max.apply(Math,I)}});if(K._options.height&&K._options.height<2){J.height=J.width*K._options.height}return J},_createThumbnails:function(){this.get("total").innerHTML=this.getDataLength();var L,S,T,I,R,F,Q=this,M=this._options,H=(function(){var U=Q.$("thumbnails").find(".active");if(!U.length){return false}return U.find("img").attr("src")}()),P=typeof M.thumbnails==="string"?M.thumbnails.toLowerCase():null,K=function(U){return s.defaultView&&s.defaultView.getComputedStyle?s.defaultView.getComputedStyle(T.container,null)[U]:F.css(U)},J=function(V,W,U){return function(){a(U).append(V);Q.trigger({type:Galleria.THUMBNAIL,thumbTarget:V,index:W,galleriaData:Q.getData(W)})}},N=function(U){if(M.pauseOnInteraction){Q.pause()}var V=a(U.currentTarget).data("index");if(Q.getIndex()!==V){Q.show(V)}U.preventDefault()},O=function(U){U.scale({width:U.data.width,height:U.data.height,crop:M.thumbCrop,margin:M.thumbMargin,canvas:M.useCanvas,complete:function(aa){var ab=["left","top"],V=["Width","Height"],Y,W,X=Q.getData(aa.index),Z=X.thumb.split(":");a.each(V,function(ac,ad){Y=ad.toLowerCase();if((M.thumbCrop!==true||M.thumbCrop===Y)&&M.thumbFit){W={};W[Y]=aa[Y];a(aa.container).css(W);W={};W[ab[ac]]=0;a(aa.image).css(W)}aa["outer"+ad]=a(aa.container)["outer"+ad](true)});D.toggleQuality(aa.image,M.thumbQuality===true||(M.thumbQuality==="auto"&&aa.original.width<aa.width*3));if(X.iframe&&Z.length==2&&Z[0] in p){p[Z[0]].getThumb(Z[1],(function(ac){return function(ad){ac.src=ad}}(aa.image)))}Q.trigger({type:Galleria.THUMBNAIL,thumbTarget:aa.image,index:aa.data.order,galleriaData:Q.getData(aa.data.order)})}})};this._thumbnails=[];this.$("thumbnails").empty();for(L=0;this._data[L];L++){I=this._data[L];if(M.thumbnails===true&&(I.thumb||I.image)){T=new Galleria.Picture(L);T.index=L;S=I.thumb||I.image;this.$("thumbnails").append(T.container);F=a(T.container);T.data={width:D.parseValue(K("width")),height:D.parseValue(K("height")),order:L};if(M.thumbFit&&M.thumbCrop!==true){F.css({width:"auto",height:"auto"})}else{F.css({width:T.data.width,height:T.data.height})}R=S.split(":");if(R.length==2&&R[0] in p){T.load("data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D",{height:T.data.height,width:T.data.height*1.25},O)}else{T.load(S,O)}if(M.preload==="all"){T.preload(I.image)}}else{if(I.iframe||P==="empty"||P==="numbers"){T={container:D.create("galleria-image"),image:D.create("img","span"),ready:true};if(P==="numbers"){a(T.image).text(L+1)}if(I.iframe){a(T.image).addClass("iframe")}this.$("thumbnails").append(T.container);G.setTimeout((J)(T.image,L,T.container),50+(L*20))}else{T={container:null,image:null}}}a(T.container).add(M.keepSource&&M.linkSourceImages?I.original:null).data("index",L).bind(M.thumbEventType,N);if(H===S){a(T.container).addClass("active")}this._thumbnails.push(T)}},_run:function(){var F=this;F._createThumbnails();D.wait({timeout:10000,until:function(){if(Galleria.OPERA){F.$("stage").css("display","inline-block")}F._stageWidth=F.$("stage").width();F._stageHeight=F.$("stage").height();return(F._stageWidth&&F._stageHeight>50)},success:function(){g.push(F);D.show(F.get("counter"));if(F._options.carousel){F._carousel.bindControls()}if(F._options.autoplay){F.pause();if(typeof F._options.autoplay==="number"){F._playtime=F._options.autoplay}F.trigger(Galleria.PLAY);F._playing=true}if(F._firstrun){if(typeof F._options.show==="number"){F.show(F._options.show)}return}F._firstrun=true;if(Galleria.History){Galleria.History.change(function(H){if(isNaN(H)){G.history.go(-1)}else{F.show(H,C,true)}})}F.trigger(Galleria.READY);Galleria.theme.init.call(F,F._options);a.each(Galleria.ready.callbacks,function(){this.call(F,F._options)});F._options.extend.call(F,F._options);if(/^[0-9]{1,4}$/.test(x)&&Galleria.History){F.show(x,C,true)}else{if(F._data[F._options.show]){F.show(F._options.show)}}},error:function(){Galleria.raise("Stage width or height is too small to show the gallery. Traced measures: width:"+F._stageWidth+"px, height: "+F._stageHeight+"px.",true)}})},load:function(J,H,F){var I=this;this._data=[];this._thumbnails=[];this.$("thumbnails").empty();if(typeof H==="function"){F=H;H=null}J=J||this._options.dataSource;H=H||this._options.dataSelector;F=F||this._options.dataConfig;if(/^function Object/.test(J.constructor)){J=[J]}if(J.constructor===Array){if(this.validate(J)){this._data=J;this._parseData().trigger(Galleria.DATA)}else{Galleria.raise("Load failed: JSON Array not valid.")}return this}H+=",.video,.iframe";a(J).find(H).each(function(N,L){L=a(L);var K={},O=L.parent(),M=O.attr("href"),P=O.attr("rel");if(M&&(L[0].nodeName=="IMG"||L.hasClass("video"))&&q(M)){K.video=M}else{if(M&&L.hasClass("iframe")){K.iframe=M}else{K.image=K.big=M}}if(P){K.big=P}a.each("big title description link layer".split(" "),function(Q,R){if(L.data(R)){K[R]=L.data(R)}});I._data.push(a.extend({title:L.attr("title")||"",thumb:L.attr("src"),image:L.attr("src"),big:L.attr("src"),description:L.attr("alt")||"",link:L.attr("longdesc"),original:L.get(0)},K,F(L)))});if(this.getDataLength()){this._parseData().trigger(Galleria.DATA)}else{Galleria.raise("Load failed: no data found.")}return this},_parseData:function(){var H=this,F;a.each(this._data,function(J,I){F=H._data[J];if("thumb" in I===false){F.thumb=I.image}if(!"big" in I){F.big=I.image}if("video" in I){var K=q(I.video);if(K){F.iframe=p[K.provider].embed(K.id)+(function(){if(typeof H._options[K.provider]=="object"){var M="?",L=[];a.each(H._options[K.provider],function(N,O){L.push(N+"="+O)});if(K.provider=="youtube"){L=["wmode=opaque"].concat(L)}return M+L.join("&")}return""}());delete F.video;if(!("thumb" in F)||!F.thumb){F.thumb=K.provider+":"+K.id}}}});return this},destroy:function(){this.get("target").innerHTML=this._original.html;return this},splice:function(){var H=this,F=D.array(arguments);G.setTimeout(function(){A.splice.apply(H._data,F);H._parseData()._createThumbnails()},2);return H},push:function(){var H=this,F=D.array(arguments);G.setTimeout(function(){A.push.apply(H._data,F);H._parseData()._createThumbnails()},2);return H},_getActive:function(){return this._controls.getActive()},validate:function(F){return true},bind:function(H,F){H=k(H);this.$("container").bind(H,this.proxy(F));return this},unbind:function(F){F=k(F);this.$("container").unbind(F);return this},trigger:function(F){F=typeof F==="object"?a.extend(F,{scope:this}):{type:k(F),scope:this};this.$("container").trigger(F);return this},addIdleState:function(F,H){this._idle.add.apply(this._idle,D.array(arguments));return this},removeIdleState:function(F){this._idle.remove.apply(this._idle,D.array(arguments));return this},enterIdleMode:function(){this._idle.hide();return this},exitIdleMode:function(){this._idle.showAll();return this},enterFullscreen:function(F){this._fullscreen.enter.apply(this,D.array(arguments));return this},exitFullscreen:function(F){this._fullscreen.exit.apply(this,D.array(arguments));return this},toggleFullscreen:function(F){this._fullscreen[this.isFullscreen()?"exit":"enter"].apply(this,D.array(arguments));return this},bindTooltip:function(F,H){this._tooltip.bind.apply(this._tooltip,D.array(arguments));return this},defineTooltip:function(F,H){this._tooltip.define.apply(this._tooltip,D.array(arguments));return this},refreshTooltip:function(F){this._tooltip.show.apply(this._tooltip,D.array(arguments));return this},openLightbox:function(){this._lightbox.show.apply(this._lightbox,D.array(arguments));return this},closeLightbox:function(){this._lightbox.hide.apply(this._lightbox,D.array(arguments));return this},getActiveImage:function(){return this._getActive().image||C},getActiveThumb:function(){return this._thumbnails[this._active].image||C},getMousePosition:function(F){return{x:F.pageX-this.$("container").offset().left,y:F.pageY-this.$("container").offset().top}},addPan:function(P){if(this._options.imageCrop===false){return}P=a(P||this.getActiveImage());var T=this,V=P.width()/2,W=P.height()/2,L=parseInt(P.css("left"),10),M=parseInt(P.css("top"),10),J=L||0,K=M||0,N=0,O=0,F=false,U=D.timestamp(),H=0,R=0,S=function(Z,Y,aa){if(Z>0){R=Math.round(Math.max(Z*-1,Math.min(0,Y)));if(H!==R){H=R;if(y===8){P.parent()["scroll"+aa](R*-1)}else{var X={};X[aa.toLowerCase()]=R;P.css(X)}}}},I=function(X){if(D.timestamp()-U<50){return}F=true;V=T.getMousePosition(X).x;W=T.getMousePosition(X).y},Q=function(X){if(!F){return}N=P.width()-T._stageWidth;O=P.height()-T._stageHeight;L=V/T._stageWidth*N*-1;M=W/T._stageHeight*O*-1;J+=(L-J)/T._options.imagePanSmoothness;K+=(M-K)/T._options.imagePanSmoothness;S(O,K,"Top");S(N,J,"Left")};if(y===8){P.parent().scrollTop(K*-1).scrollLeft(J*-1);P.css({top:0,left:0})}this.$("stage").unbind("mousemove",I).bind("mousemove",I);D.addTimer("pan"+T._id,Q,50,true);return this},proxy:function(F,H){if(typeof F!=="function"){return v}H=H||this;return function(){return F.apply(H,D.array(arguments))}},removePan:function(){this.$("stage").unbind("mousemove");D.clearTimer("pan"+this._id);return this},addElement:function(H){var F=this._dom;a.each(D.array(arguments),function(J,I){F[I]=D.create("galleria-"+I)});return this},attachKeyboard:function(F){this._keyboard.attach.apply(this._keyboard,D.array(arguments));return this},detachKeyboard:function(){this._keyboard.detach.apply(this._keyboard,D.array(arguments));return this},appendChild:function(H,F){this.$(H).append(this.get(F)||F);return this},prependChild:function(H,F){this.$(H).prepend(this.get(F)||F);return this},remove:function(F){this.$(D.array(arguments).join(",")).remove();return this},append:function(F){var H,I;for(H in F){if(F.hasOwnProperty(H)){if(F[H].constructor===Array){for(I=0;F[H][I];I++){this.appendChild(H,F[H][I])}}else{this.appendChild(H,F[H])}}}return this},_scaleImage:function(H,I){H=H||this._controls.getActive();if(!H){return}var K=this,F,J=function(L){a(L.container).children(":first").css({top:Math.max(0,D.parseValue(L.image.style.top)),left:Math.max(0,D.parseValue(L.image.style.left)),width:D.parseValue(L.image.width),height:D.parseValue(L.image.height)})};I=a.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition},I);if(this._options.layerFollow&&this._options.imageCrop!==true){if(typeof I.complete=="function"){F=I.complete;I.complete=function(){F.call(H,H);J(H)}}else{I.complete=J}}else{a(H.container).children(":first").css({top:0,left:0})}H.scale(I);return this},updateCarousel:function(){this._carousel.update();return this},resize:function(J,I){if(typeof J=="function"){I=J;J=C}J=a.extend({width:0,height:0},J);var L=this,F=this.$("container"),H=this._options.responsive=="aspect"&&(!J.width||!J.height),K;a.each(J,function(M,N){if(!N){F[M]("auto");J[M]=L._getWH()[M]}});if(H){K=Math.min(J.width/this._width,J.height/this._height)}a.each(J,function(M,N){F[M](K?K*L["_"+M]:N)});return this.rescale(I)},rescale:function(K,H,F){var J=this;if(typeof K==="function"){F=K;K=C}var I=function(){J._stageWidth=K||J.$("stage").width();J._stageHeight=H||J.$("stage").height();J._scaleImage();if(J._options.carousel){J.updateCarousel()}J.trigger(Galleria.RESCALE);if(typeof F==="function"){F.call(J)}};if(Galleria.WEBKIT&&!Galleria.TOUCH&&!K&&!H){D.addTimer(false,I,10)}else{I.call(J)}return this},refreshImage:function(){this._scaleImage();if(this._options.imagePan){this.addPan()}return this},show:function(H,I,F){if(H===false||(!this._options.queue&&this._queue.stalled)){return}H=Math.max(0,Math.min(parseInt(H,10),this.getDataLength()-1));I=typeof I!=="undefined"?!!I:H<this.getIndex();F=F||false;if(!F&&Galleria.History){Galleria.History.set(H.toString());return}this._active=H;A.push.call(this._queue,{index:H,rewind:I});if(!this._queue.stalled){this._show()}return this},_show:function(){var S=this,R=this._queue[0],J=this.getData(R.index);if(!J){return}var T=J.iframe||(this.isFullscreen()&&"big" in J?J.big:J.image),F=this._controls.getActive(),P=this._controls.getNext(),H=P.isCached(T),U=this._thumbnails[R.index],M=function(){a(P.image).trigger("mouseup")};var I=(function(W,X,V,Y,Z){return function(){var aa;S._queue.stalled=false;D.toggleQuality(X.image,S._options.imageQuality);S._layers[S._controls.active].innerHTML="";a(V.container).css({zIndex:0,opacity:0}).show();if(V.isIframe){a(V.container).find("iframe").remove()}S.$("container").toggleClass("iframe",!!W.iframe);a(X.container).css({zIndex:1,left:0,top:0}).show();S._controls.swap();if(S._options.imagePan){S.addPan(X.image)}if(W.link||S._options.lightbox||S._options.clicknext){a(X.image).css({cursor:"pointer"}).bind("mouseup",function(){if(S._options.clicknext&&!Galleria.TOUCH){if(S._options.pauseOnInteraction){S.pause()}S.next();return}if(W.link){if(S._options.popupLinks){aa=G.open(W.link,"_blank")}else{G.location.href=W.link}return}if(S._options.lightbox){S.openLightbox()}})}A.shift.call(S._queue);if(S._queue.length){S._show()}S._playCheck();S.trigger({type:Galleria.IMAGE,index:Y.index,imageTarget:X.image,thumbTarget:Z.image,galleriaData:W})}}(J,P,F,R,U));if(this._options.carousel&&this._options.carouselFollow){this._carousel.follow(R.index)}if(this._options.preload){var Q,L,N=this.getNext(),O;try{for(L=this._options.preload;L>0;L--){Q=new Galleria.Picture();O=S.getData(N);Q.preload(this.isFullscreen()&&"big" in O?O.big:O.image);N=S.getNext(N)}}catch(K){}}D.show(P.container);P.isIframe=!!J.iframe;a(S._thumbnails[R.index].container).addClass("active").siblings(".active").removeClass("active");S.trigger({type:Galleria.LOADSTART,cached:H,index:R.index,rewind:R.rewind,imageTarget:P.image,thumbTarget:U.image,galleriaData:J});P.load(T,function(W){var V=a(S._layers[1-S._controls.active]).html(J.layer||"").hide();S._scaleImage(W,{complete:function(X){if("image" in F){D.toggleQuality(F.image,false)}D.toggleQuality(X.image,false);S._queue.stalled=true;S.removePan();S.setInfo(R.index);S.setCounter(R.index);if(J.layer){V.show();if(J.link||S._options.lightbox||S._options.clicknext){V.css("cursor","pointer").unbind("mouseup").mouseup(M)}}S.trigger({type:Galleria.LOADFINISH,cached:H,index:R.index,rewind:R.rewind,imageTarget:X.image,thumbTarget:S._thumbnails[R.index].image,galleriaData:S.getData(R.index)});var Z=S._options.transition;a.each({initial:F.image===null,touch:Galleria.TOUCH,fullscreen:S.isFullscreen()},function(ab,aa){if(aa&&S._options[ab+"Transition"]!==C){Z=S._options[ab+"Transition"];return false}});if(Z in o===false){I()}else{var Y={prev:F.container,next:X.container,rewind:R.rewind,speed:S._options.transitionSpeed||400};o[Z].call(S,Y,I)}}})})},getNext:function(F){F=typeof F==="number"?F:this.getIndex();return F===this.getDataLength()-1?0:F+1},getPrev:function(F){F=typeof F==="number"?F:this.getIndex();return F===0?this.getDataLength()-1:F-1},next:function(){if(this.getDataLength()>1){this.show(this.getNext(),false)}return this},prev:function(){if(this.getDataLength()>1){this.show(this.getPrev(),true)}return this},get:function(F){return F in this._dom?this._dom[F]:null},getData:function(F){return F in this._data?this._data[F]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return typeof this._active==="number"?this._active:false},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(F){return typeof F==="undefined"?this._options:this._options[F]},setOptions:function(F,H){if(typeof F==="object"){a.extend(this._options,F)}else{this._options[F]=H}return this},play:function(F){this._playing=true;this._playtime=F||this._playtime;this._playCheck();this.trigger(Galleria.PLAY);return this},pause:function(){this._playing=false;this.trigger(Galleria.PAUSE);return this},playToggle:function(F){return(this._playing)?this.pause():this.play(F)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var K=this,J=0,H=20,I=D.timestamp(),L="play"+this._id;if(this._playing){D.clearTimer(L);var F=function(){J=D.timestamp()-I;if(J>=K._playtime&&K._playing){D.clearTimer(L);K.next();return}if(K._playing){K.trigger({type:Galleria.PROGRESS,percent:Math.ceil(J/K._playtime*100),seconds:Math.floor(J/1000),milliseconds:J});D.addTimer(L,F,H)}};D.addTimer(L,F,H)}},setPlaytime:function(F){this._playtime=F;return this},setIndex:function(F){this._active=F;return this},setCounter:function(H){if(typeof H==="number"){H++}else{if(typeof H==="undefined"){H=this.getIndex()+1}}this.get("current").innerHTML=H;if(y){var F=this.$("counter"),I=F.css("opacity");if(parseInt(I,10)===1){D.removeAlpha(F[0])}else{this.$("counter").css("opacity",I)}}return this},setInfo:function(H){var I=this,F=this.getData(H);a.each(["title","description"],function(K,L){var J=I.$("info-"+L);if(!!F[L]){J[F[L].length?"show":"hide"]().html(F[L])}else{J.empty().hide()}});return this},hasInfo:function(I){var F="title description".split(" "),H;for(H=0;F[H];H++){if(!!this.getData(I)[F[H]]){return true}}return false},jQuery:function(J){var I=this,H=[];a.each(J.split(","),function(L,K){K=a.trim(K);if(I.get(K)){H.push(K)}});var F=a(I.get(H.shift()));a.each(H,function(L,K){F=F.add(I.get(K))});return F},$:function(F){return this.jQuery.apply(this,D.array(arguments))}};a.each(f,function(H,F){var I=/_/.test(F)?F.replace(/_/g,""):F;Galleria[F.toUpperCase()]="galleria."+I});a.extend(Galleria,{IE9:y===9,IE8:y===8,IE7:y===7,IE6:y===6,IE:y,WEBKIT:/webkit/.test(z),CHROME:/chrome/.test(z),SAFARI:/safari/.test(z)&&!(/chrome/.test(z)),QUIRK:(y&&s.compatMode&&s.compatMode==="BackCompat"),MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!G.opera,IPHONE:/iphone/.test(z),IPAD:/ipad/.test(z),ANDROID:/android/.test(z),TOUCH:("ontouchstart" in s)});Galleria.addTheme=function(I){if(!I.name){Galleria.raise("No theme name specified")}if(typeof I.defaults!=="object"){I.defaults={}}else{I.defaults=j(I.defaults)}var F=false,H;if(typeof I.css==="string"){a("link").each(function(J,K){H=new RegExp(I.css);if(H.test(K.href)){F=true;m(I);return false}});if(!F){a("script").each(function(J,K){H=new RegExp("galleria\\."+I.name.toLowerCase()+"\\.");if(H.test(K.src)){F=K.src.replace(/[^\/]*$/,"")+I.css;D.addTimer("css",function(){D.loadCSS(F,"galleria-theme",function(){m(I)})},1)}})}if(!F){Galleria.raise("No theme CSS loaded")}}else{m(I)}return I};Galleria.loadTheme=function(K,J){var I=false,H=g.length,F=G.setTimeout(function(){Galleria.raise("Theme at "+K+" could not load, check theme path.",true)},5000);Galleria.theme=C;D.loadScript(K,function(){G.clearTimeout(F);if(H){var L=[];a.each(Galleria.get(),function(N,O){var P=a.extend(O._original.options,{data_source:O._data},J);O.$("container").remove();var M=new Galleria();M._id=O._id;M.init(O._original.target,P);L.push(M)});g=L}});return Galleria};Galleria.get=function(F){if(!!i[F]){return i[F]}else{if(typeof F!=="number"){return i}else{Galleria.raise("Gallery index "+F+" not found")}}};Galleria.configure=function(F,I){var H={};if(typeof F=="string"&&I){H[F]=I;F=H}else{a.extend(H,F)}Galleria.configure.options=H;a.each(Galleria.get(),function(J,K){K.setOptions(H)});return Galleria};Galleria.configure.options={};Galleria.on=function(H,F){if(!H){return}Galleria.on.binds.push({type:H,callback:F||v});a.each(Galleria.get(),function(I,J){J.bind(H,F)});return Galleria};Galleria.on.binds=[];Galleria.run=function(H,F){a(H||"#galleria").galleria(F);return Galleria};Galleria.addTransition=function(H,F){o[H]=F;return Galleria};Galleria.utils=D;Galleria.log=(function(){if("console" in G&&"log" in G.console){return G.console.log}else{return function(){G.alert(D.array(arguments).join(", "))}}}());Galleria.ready=function(F){a.each(g,function(I,H){F.call(H,H._options)});Galleria.ready.callbacks.push(F);return Galleria};Galleria.ready.callbacks=[];Galleria.raise=function(J,I){var L=I?"Fatal error":"Error",K=this,F={color:"#fff",position:"absolute",top:0,left:0,zIndex:100000},H=function(N){var M='<div style="padding:4px;margin:0 0 2px;background:#'+(I?"811":"222")+'";>'+(I?"<strong>"+L+": </strong>":"")+N+"</div>";a.each(i,function(){var O=this.$("errors"),P=this.$("target");if(!O.length){P.css("position","relative");O=this.addElement("errors").appendChild("target","errors").$("errors").css(F)}O.append(M)});if(!i.length){a("<div>").css(a.extend(F,{position:"fixed"})).append(M).appendTo(t().body)}};if(r){H(J);if(I){throw new Error(L+": "+J)}}else{if(I){if(h){return}h=true;I=false;H("Gallery could not load.")}}};Galleria.version=E;Galleria.requires=function(H,F){F=F||"You need to upgrade Galleria to version "+H+" to use one or more components.";if(Galleria.version<H){Galleria.raise(F,true)}return Galleria};Galleria.Picture=function(F){this.id=F||null;this.image=null;this.container=D.create("galleria-image");a(this.container).css({overflow:"hidden",position:"relative"});this.original={width:0,height:0};this.ready=false;this.isIframe=false};Galleria.Picture.prototype={cache:{},show:function(){D.show(this.image)},hide:function(){D.moveOut(this.image)},clear:function(){this.image=null},isCached:function(F){return !!this.cache[F]},preload:function(F){a(new Image()).load((function(I,H){return function(){H[I]=I}}(F,this.cache))).attr("src",F)},load:function(P,O,I){if(typeof O=="function"){I=O;O=null}if(this.isIframe){var K="if"+new Date().getTime();this.image=a("<iframe>",{src:P,frameborder:0,id:K,allowfullscreen:true,css:{visibility:"hidden"}})[0];a(this.container).find("iframe,img").remove();this.container.appendChild(this.image);a("#"+K).load((function(R,Q){return function(){G.setTimeout(function(){a(R.image).css("visibility","visible");if(typeof Q=="function"){Q.call(R,R)}},10)}}(this,I)));return this.container}this.image=new Image();var J=0,M=false,N=false,F=a(this.container),H=a(this.image),L=(function(R,Q,S){return function(){var T=function(){a(this).unbind("load");R.original=O||{height:this.height,width:this.width};R.container.appendChild(this);R.cache[S]=S;if(typeof Q=="function"){G.setTimeout(function(){Q.call(R,R)},1)}};if((!this.width||!this.height)){G.setTimeout((function(U){return function(){if(U.width&&U.height){T.call(U)}else{if(!N){a(new Image()).load(L).attr("src",U.src);N=true}else{Galleria.raise("Could not extract width/height from image: "+U.src+". Traced measures: width:"+U.width+"px, height: "+U.height+"px.")}}}}(this)),2)}else{T.call(this)}}}(this,I,P));F.find("iframe,img").remove();H.css("display","block");D.hide(this.image);a.each("minWidth minHeight maxWidth maxHeight".split(" "),function(Q,R){H.css(R,(/min/.test(R)?"0":"none"))});if(this.cache[P]){H.load(L).attr("src",P);return this.container}H.load(L).error(function(){if(!M){M=true;G.setTimeout((function(Q,R){return function(){Q.attr("src",R+"?"+D.timestamp())}}(a(this),P)),50)}else{if(u){a(this).attr("src",u)}else{Galleria.raise("Image not found: "+P)}}}).attr("src",P);return this.container},scale:function(K){var L=this;K=a.extend({width:0,height:0,min:C,max:C,margin:0,complete:v,position:"center",crop:false,canvas:false},K);if(this.isIframe){a(this.image).width(K.width).height(K.height).removeAttr("width").removeAttr("height");a(this.container).width(K.width).height(K.height);K.complete.call(L,L);try{if(this.image.contentWindow){a(this.image.contentWindow).trigger("resize")}}catch(I){}return this.container}if(!this.image){return this.container}var M,J,F=a(L.container),H;D.wait({until:function(){M=K.width||F.width()||D.parseValue(F.css("width"));J=K.height||F.height()||D.parseValue(F.css("height"));return M&&J},success:function(){var U=(M-K.margin*2)/L.original.width,T=(J-K.margin*2)/L.original.height,R=Math.min(U,T),Q=Math.max(U,T),O={"true":Q,width:U,height:T,"false":R,landscape:L.original.width>L.original.height?Q:R,portrait:L.original.width<L.original.height?Q:R},X=O[K.crop.toString()],N="";if(K.max){X=Math.min(K.max,X)}if(K.min){X=Math.max(K.min,X)}a.each(["width","height"],function(Y,Z){a(L.image)[Z](L[Z]=L.image[Z]=Math.round(L.original[Z]*X))});a(L.container).width(M).height(J);if(K.canvas&&d){d.elem.width=L.width;d.elem.height=L.height;N=L.image.src+":"+L.width+"x"+L.height;L.image.src=d.cache[N]||(function(Z){d.context.drawImage(L.image,0,0,L.original.width*X,L.original.height*X);try{H=d.elem.toDataURL();d.length+=H.length;d.cache[Z]=H;return H}catch(Y){return L.image.src}}(N))}var V={},S={},P=function(ad,ab,aa){var ac=0;if(/\%/.test(ad)){var Y=parseInt(ad,10)/100,Z=L.image[ab]||a(L.image)[ab]();ac=Math.ceil(Z*-1*Y+aa*Y)}else{ac=D.parseValue(ad)}return ac},W={top:{top:0},left:{left:0},right:{left:"100%"},bottom:{top:"100%"}};a.each(K.position.toLowerCase().split(" "),function(Y,Z){if(Z==="center"){Z="50%"}V[Y?"top":"left"]=Z});a.each(V,function(Y,Z){if(W.hasOwnProperty(Z)){a.extend(S,W[Z])}});V=V.top?a.extend(V,S):S;V=a.extend({top:"50%",left:"50%"},V);a(L.image).css({position:"absolute",top:P(V.top,"height",J),left:P(V.left,"width",M)});L.show();L.ready=true;K.complete.call(L,L)},error:function(){Galleria.raise("Could not scale image: "+L.image.src)},timeout:1000});return this}};a.extend(a.easing,{galleria:function(F,K,H,I,J){if((K/=J/2)<1){return I/2*K*K*K+H}return I/2*((K-=2)*K*K+2)+H},galleriaIn:function(F,K,H,I,J){return I*(K/=J)*K+H},galleriaOut:function(F,K,H,I,J){return -I*(K/=J)*(K-2)+H}});a.fn.galleria=function(F){var H=this.selector;if(!a(this).length){a(function(){if(a(H).length){a(H).galleria(F)}else{Galleria.utils.wait({until:function(){return a(H).length},success:function(){a(H).galleria(F)},error:function(){Galleria.raise('Init failed: Galleria could not find the element "'+H+'".')},timeout:5000})}});return this}return this.each(function(){if(!a.data(this,"galleria")){a.data(this,"galleria",new Galleria().init(this,F))}})}}(jQuery));